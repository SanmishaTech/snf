import{r as d,j as t,L as B,a7 as re,a4 as ae,aa as ie,C as le,M as ce,P as de,B as me}from"./index-BDS61FFt.js";const _=1,pe=4,xe=({product:l,onAddToCart:U,initialVariantId:X=null,showVariants:w=!0})=>{var M;const[N,Y]=d.useState(X),[v,S]=d.useState(!1),[y,E]=d.useState(""),[g,I]=d.useState(1),C=d.useRef(null),O=d.useRef(null),D=d.useRef(null);d.useEffect(()=>{const e=n=>{C.current&&!C.current.contains(n.target)&&S(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const r=l.variants??[],k=d.useMemo(()=>r.length>0?r.filter(e=>!e.isHidden&&!e.notInStock):[],[r]),o=d.useMemo(()=>N?r.find(e=>e.id===N)??k[0]??r[0]:k[0]??r[0],[N,k,r]),u=d.useMemo(()=>{if(o)return o.buyOncePrice||o.mrp||0;if(r&&r.length>0){const e=r.filter(n=>!n.isHidden&&!n.notInStock).map(n=>n.buyOncePrice||n.mrp||0).filter(n=>typeof n=="number"&&isFinite(n)&&n>0);return e.length>0?Math.min(...e):0}return 0},[o,r]),h=(o==null?void 0:o.mrp)||0,P=h>u?(h-u)/h:0,A=!1,L=w&&((r==null?void 0:r.length)||0)>1,G=L&&r.length<=pe,R=e=>{Y(e),S(!1)},J=()=>{const e=o||{id:0,name:"Default",buyOncePrice:l.buyOncePrice,mrp:l.mrp,productId:l.product.id,depotId:_,hsnCode:"",minimumQty:1,closingQty:999,notInStock:!1,isHidden:!1,createdAt:new Date,updatedAt:new Date,depot:{id:_,name:"Default Depot",address:"",isOnline:!0},product:l.product};U(l,e,g);try{const n=O.current,a=D.current,c=document.getElementById("snf-cart-button");if(!a||!c)return;const x=a.style.transform,f=a.style.transition;a.style.transition=`${f?f+", ":""}transform 120ms ease`,a.style.transform="scale(0.97)",setTimeout(()=>{a.style.transform=x,a.style.transition=f},140);const m=a.getBoundingClientRect(),p=c.getBoundingClientRect(),s=document.createElement("img");s.src=(n==null?void 0:n.src)||"",s.setAttribute("aria-hidden","true");const b=56;s.style.position="fixed",s.style.left=`${m.left+m.width/2-b/2}px`,s.style.top=`${m.top+m.height/2-b/2}px`,s.style.width=`${b}px`,s.style.height=`${b}px`,s.style.objectFit="cover",s.style.zIndex="9999",s.style.borderRadius="8px",s.style.pointerEvents="none",s.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)",document.body.appendChild(s);const T=p.left+p.width/2-(m.left+m.width/2),q=p.top+p.height/2-(m.top+m.height/2),W=T*.2,Z=q*.2-20;s.style.transition="transform 180ms ease-out, opacity 180ms ease-out",s.style.transform="translate(0px, 0px) scale(0.9)",s.style.opacity="0.9",requestAnimationFrame(()=>{s.style.transform=`translate(${W}px, ${Z}px) scale(1.02)`});const z=ee=>{if(ee.propertyName!=="transform")return;s.removeEventListener("transitionend",z),s.style.transition="transform 520ms cubic-bezier(0.22, 1, 0.36, 1), opacity 520ms ease",s.style.transform=`translate(${T}px, ${q}px) scale(0.4) rotate(8deg)`,s.style.opacity="0.25";const H=te=>{if(te.propertyName!=="transform")return;s.removeEventListener("transitionend",H);const se=getComputedStyle(c).color,i=document.createElement("span"),ne=p.left+p.width/2,oe=p.top+p.height/2,j=14;i.style.position="fixed",i.style.left=`${ne-j}px`,i.style.top=`${oe-j}px`,i.style.width=`${j*2}px`,i.style.height=`${j*2}px`,i.style.border=`2px solid ${se}`,i.style.borderRadius="9999px",i.style.opacity="0.5",i.style.pointerEvents="none",i.style.zIndex="9999",i.style.transform="scale(0.4)",i.style.transition="transform 420ms ease, opacity 420ms ease",document.body.appendChild(i),requestAnimationFrame(()=>{i.style.transform="scale(1.8)",i.style.opacity="0"}),setTimeout(()=>i.remove(),460),s&&s.parentNode&&s.parentNode.removeChild(s)};s.addEventListener("transitionend",H)};s.addEventListener("transitionend",z)}catch{}},K=()=>I(e=>Math.min(99,e+1)),V=()=>I(e=>Math.max(1,e-1)),Q=d.useMemo(()=>{const e=y.trim().toLowerCase();return e?r.filter(n=>{var x,f;const a=((x=n.name)==null?void 0:x.toLowerCase())||"",c=((f=n.sku)==null?void 0:f.toLowerCase())||"";return a.includes(e)||c.includes(e)}):r},[r,y]),F=(M=l==null?void 0:l.product)==null?void 0:M.attachmentUrl,$=F?`https://www.indraai.in${F}`:"";return t.jsxs("article",{className:"group rounded-md border border-border/60 bg-card text-card-foreground overflow-hidden shadow-sm hover:shadow-md hover:border-border transition-all duration-200 h-full flex flex-col",children:[t.jsxs(B,{to:`/snf/product/${l.product.id}`,className:"block relative aspect-square min-h-[88px] sm:min-h-[96px] bg-muted/30 overflow-hidden",children:[t.jsx("img",{ref:O,src:$&&$.trim().length>0?$:"https://images.unsplash.com/photo-1546470427-0fd2788c37e3?auto=format&fit=crop&w=400&q=80",alt:l.product.name,loading:"lazy",className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-[1.03]"}),w&&P>0&&t.jsxs("div",{className:"absolute left-2 top-2 rounded-full bg-destructive/90 text-white text-xs px-2.5 py-1 shadow-sm font-medium",children:["-",Math.round(P*100),"%"]}),A]}),t.jsxs("div",{className:"p-2 md:p-2.5 space-y-2 md:space-y-2.5 flex-1 flex flex-col",children:[t.jsx("h3",{className:"font-semibold text-[12px] md:text-[13px] leading-tight line-clamp-1 min-h-[1.25rem]",children:t.jsx(B,{to:`/snf/product/${l.product.id}`,className:"hover:text-primary transition-colors",children:l.product.name})}),L&&t.jsx(t.Fragment,{children:G?t.jsx("div",{className:"flex flex-wrap gap-1 md:gap-1.5",children:r.map(e=>{const n=e.buyOncePrice||e.mrp||0,a=e.id===(o==null?void 0:o.id),c=!e.isHidden&&!e.notInStock;return t.jsxs("button",{onClick:()=>R(e.id),disabled:!c,className:["inline-flex items-center gap-1 rounded-full border px-2 py-1 text-[11px] transition-colors",a?"bg-primary/10 border-primary text-primary":"hover:bg-accent",c?"":"opacity-50 cursor-not-allowed"].join(" "),"aria-pressed":a,children:[t.jsx("span",{className:"font-medium",children:e.name}),t.jsxs("span",{className:"text-muted-foreground",children:["₹",n.toFixed(0)]}),!c&&t.jsx("span",{className:"text-muted-foreground",children:"(OOS)"})]},e.id)})}):t.jsxs("div",{className:"relative",ref:C,children:[t.jsxs("button",{onClick:()=>S(e=>!e),className:"w-full flex items-center justify-between px-2 py-1.5 border rounded-md text-[13px] hover:bg-accent transition-colors","aria-expanded":v,children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium",children:o?o.name:"Select variant"}),o&&u>0&&t.jsxs("span",{className:"text-muted-foreground",children:["₹",u.toFixed(2)]})]}),t.jsx(re,{className:`h-4 w-4 transition-transform ${v?"rotate-180":""}`})]}),v&&t.jsxs("div",{className:"absolute z-20 w-full mt-1 bg-popover border rounded-md shadow-lg overflow-hidden",children:[t.jsxs("div",{className:"flex items-center gap-1.5 p-1.5 border-b bg-background",children:[t.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),t.jsx("input",{value:y,onChange:e=>E(e.target.value),placeholder:"Search variant...",className:"w-full bg-transparent text-sm outline-none"}),y&&t.jsx("button",{className:"p-1 rounded hover:bg-accent",onClick:()=>E(""),"aria-label":"Clear search",children:t.jsx(ie,{className:"h-4 w-4"})})]}),t.jsx("div",{className:"max-h-48 overflow-y-auto",children:Q.length===0?t.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"No variants found"}):Q.map(e=>{const n=e.buyOncePrice||e.mrp||0,a=e.id===(o==null?void 0:o.id),c=!e.isHidden&&!e.notInStock&&(e.closingQty===void 0||e.closingQty>0),x=e.closingQty!==void 0&&e.closingQty>0&&e.closingQty<=10;return t.jsxs("button",{onClick:()=>R(e.id),disabled:!c,className:["w-full px-2 py-1.5 text-left hover:bg-accent transition-colors flex items-center justify-between",c?"":"opacity-50 cursor-not-allowed",a?"bg-accent":""].join(" "),children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsx("span",{className:"font-medium text-sm",children:e.name}),t.jsx("span",{className:"text-xs text-muted-foreground",children:x?`Only ${e.closingQty} left`:c?"In Stock":"Out of stock"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-sm font-semibold",children:["₹",n.toFixed(2)]}),a&&t.jsx(le,{className:"h-4 w-4 text-primary"})]})]},e.id)})})]})]})}),t.jsxs("div",{className:"flex items-baseline gap-1",children:[t.jsxs("span",{className:"text-sm md:text-base font-semibold",children:["₹",u>0?u.toFixed(2):"N/A"]}),w&&P>0&&h>0&&t.jsxs("span",{className:"text-xs md:text-sm text-muted-foreground line-through",children:["₹",h.toFixed(2)]})]}),t.jsx("div",{className:"mt-auto flex items-stretch w-full relative z-10",children:t.jsxs("div",{className:"flex items-center border rounded-md w-full overflow-hidden",children:[t.jsx("button",{type:"button",className:"px-2 py-1 hover:bg-accent disabled:opacity-50",onClick:e=>{e.stopPropagation(),e.preventDefault(),V()},disabled:g<=1,"aria-label":"Decrease quantity",children:t.jsx(ce,{className:"h-3 w-3"})}),t.jsx("div",{className:"flex-1 min-w-0 text-center text-[12px] md:text-sm font-medium select-none py-1",children:g}),t.jsx("button",{type:"button",className:"px-2 py-1 hover:bg-accent disabled:opacity-50",onClick:e=>{e.stopPropagation(),e.preventDefault(),K()},"aria-label":"Increase quantity",disabled:(o==null?void 0:o.closingQty)!=null&&o.closingQty>0?g>=o.closingQty:!1,children:t.jsx(de,{className:"h-3 w-3"})})]})}),t.jsx("div",{className:"flex items-center gap-1 pt-1 mt-1",children:t.jsx(me,{ref:D,className:"flex-1 h-7 text-[12px]",onClick:J,disabled:A,variant:"default",children:"Add to Cart"})})]})]})};export{xe as P};
