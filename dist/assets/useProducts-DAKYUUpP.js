import{r as n}from"./index-CjAs9_jf.js";import{p as D}from"./Footer-DwSgdFzh.js";const L=t=>{const[s,E]=n.useState([]),[k,w]=n.useState([]),[m,R]=n.useState([]),[p,P]=n.useState(null),[l,d]=n.useState(!1),i=n.useCallback((o,a)=>o.map(f=>{const r=a.filter(u=>u.productId===f.id),c=r.reduce((u,S)=>{if(!u)return S;const C=u.buyOncePrice??u.mrp;return(S.buyOncePrice??S.mrp)<C?S:u},null),g=r.some(u=>!u.notInStock&&u.closingQty>0);let O=0;const v=(c==null?void 0:c.buyOncePrice)??(c==null?void 0:c.mrp),h=(c==null?void 0:c.mrp)??0;return v&&v<h&&(O=(h-v)/h),{product:f,variants:r,buyOncePrice:v||0,mrp:h,discount:O>0?O:void 0,inStock:g,deliveryTime:g?"Same day delivery":"Out of stock"}}).filter(f=>f.variants.length>0),[]),e=n.useCallback(async()=>{if(t){d(!0),P(null);try{const o=await D.getProducts(t),a=await D.getDepotVariants(t);w(o),R(a);const f=i(o,a);E(f)}catch(o){P({type:"API_ERROR",message:"Failed to fetch products",code:"PRODUCTS_FETCH_FAILED",recoverable:!0,details:o})}finally{d(!1)}}},[t,i]),y=n.useCallback(async()=>{t&&await e()},[t,e]);return n.useEffect(()=>{t&&e()},[t,e]),{products:s,rawProducts:k,variants:m,error:p,isLoading:l,refresh:y}},Q=(t,s)=>{const[E,k]=n.useState(null),[w,m]=n.useState(null),[R,p]=n.useState(!1),P=n.useCallback(async()=>{if(!(!t||!s)){p(!0),m(null);try{const[l,d]=await Promise.all([D.getProductById(t),D.getProductVariants(t,s)]);if(!l)throw{type:"API_ERROR",message:"Product not found",code:"PRODUCT_NOT_FOUND",recoverable:!1};console.log("Product data fetched:",l),console.log("Variants data fetched:",d);let i=d;i.length===0&&(console.warn(`No depot variants found for product ${t} in depot ${s}`),i=[{id:0,depotId:s,productId:t,name:"Default",hsnCode:"",minimumQty:1,closingQty:0,notInStock:!0,isHidden:!1,buyOncePrice:void 0,price15Day:void 0,price1Month:void 0,price3Day:void 0,price7Day:void 0,mrp:0,purchasePrice:void 0,createdAt:new Date,updatedAt:new Date,depot:{id:s,name:"Depot",address:"",isOnline:!0},product:l}]);const e=i.reduce((r,c)=>{if(!r)return c;const g=r.buyOncePrice??r.mrp;return(c.buyOncePrice??c.mrp)<g?c:r},null),y=(e==null?void 0:e.buyOncePrice)??(e==null?void 0:e.mrp),o=(e==null?void 0:e.mrp)??0;let a=0;y&&y<o&&(a=(o-y)/o);const f={product:l,variants:i,buyOncePrice:y||0,mrp:o,discount:a>0?a:void 0,inStock:i.some(r=>!r.notInStock&&r.closingQty>0),deliveryTime:i.some(r=>!r.notInStock&&r.closingQty>0)?"Same day delivery":"Out of stock"};k(f)}catch(l){m(l)}finally{p(!1)}}},[t,s]);return n.useEffect(()=>{t&&s&&P()},[t,s,P]),{product:E,error:w,isLoading:R,refresh:P}};export{L as a,Q as u};
