import{r as i,j as e,L as _,a8 as se,ai as ne,a7 as re,C as ae,z as oe,P as le,B as ie}from"./index-BtRkqcd7.js";const ce=4,de=({product:l,onAddToCart:N,initialVariantId:v=null})=>{var q;const[x,w]=i.useState(v),[S,C]=i.useState(!1),[g,R]=i.useState(""),[y,I]=i.useState(1),k=i.useRef(null),L=i.useRef(null),A=i.useRef(null);i.useEffect(()=>{const t=n=>{k.current&&!k.current.contains(n.target)&&C(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const a=l.variants??[],$=i.useMemo(()=>a.length>0?a.filter(t=>!t.isHidden&&!t.notInStock):[],[a]),r=i.useMemo(()=>x?a.find(t=>t.id===x)??$[0]??a[0]:$[0]??a[0],[x,$,a]),h=i.useMemo(()=>{if(r)return r.buyOncePrice||r.mrp||0;if(a&&a.length>0){const t=a.filter(n=>!n.isHidden&&!n.notInStock).map(n=>n.buyOncePrice||n.mrp||0).filter(n=>typeof n=="number"&&isFinite(n)&&n>0);return t.length>0?Math.min(...t):0}return 0},[r,a]),f=(r==null?void 0:r.mrp)||0,P=f>h?(f-h)/f:0,O=!1,Q=((a==null?void 0:a.length)||0)>1,X=Q&&a.length<=ce,F=t=>{w(t),C(!1)},V=()=>{if(r){N(l,r,y);try{const t=L.current,n=A.current,c=document.getElementById("snf-cart-button");if(!n||!c)return;const d=n.style.transform,u=n.style.transition;n.style.transition=`${u?u+", ":""}transform 120ms ease`,n.style.transform="scale(0.97)",setTimeout(()=>{n.style.transform=d,n.style.transition=u},140);const m=n.getBoundingClientRect(),p=c.getBoundingClientRect(),s=document.createElement("img");s.src=(t==null?void 0:t.src)||"",s.setAttribute("aria-hidden","true");const b=56;s.style.position="fixed",s.style.left=`${m.left+m.width/2-b/2}px`,s.style.top=`${m.top+m.height/2-b/2}px`,s.style.width=`${b}px`,s.style.height=`${b}px`,s.style.objectFit="cover",s.style.zIndex="9999",s.style.borderRadius="8px",s.style.pointerEvents="none",s.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)",document.body.appendChild(s);const D=p.left+p.width/2-(m.left+m.width/2),T=p.top+p.height/2-(m.top+m.height/2),U=D*.2,J=T*.2-20;s.style.transition="transform 180ms ease-out, opacity 180ms ease-out",s.style.transform="translate(0px, 0px) scale(0.9)",s.style.opacity="0.9",requestAnimationFrame(()=>{s.style.transform=`translate(${U}px, ${J}px) scale(1.02)`});const B=K=>{if(K.propertyName!=="transform")return;s.removeEventListener("transitionend",B),s.style.transition="transform 520ms cubic-bezier(0.22, 1, 0.36, 1), opacity 520ms ease",s.style.transform=`translate(${D}px, ${T}px) scale(0.4) rotate(8deg)`,s.style.opacity="0.25";const H=W=>{if(W.propertyName!=="transform")return;s.removeEventListener("transitionend",H);const Z=getComputedStyle(c).color,o=document.createElement("span"),ee=p.left+p.width/2,te=p.top+p.height/2,j=14;o.style.position="fixed",o.style.left=`${ee-j}px`,o.style.top=`${te-j}px`,o.style.width=`${j*2}px`,o.style.height=`${j*2}px`,o.style.border=`2px solid ${Z}`,o.style.borderRadius="9999px",o.style.opacity="0.5",o.style.pointerEvents="none",o.style.zIndex="9999",o.style.transform="scale(0.4)",o.style.transition="transform 420ms ease, opacity 420ms ease",document.body.appendChild(o),requestAnimationFrame(()=>{o.style.transform="scale(1.8)",o.style.opacity="0"}),setTimeout(()=>o.remove(),460),s&&s.parentNode&&s.parentNode.removeChild(s)};s.addEventListener("transitionend",H)};s.addEventListener("transitionend",B)}catch{}}},Y=()=>I(t=>Math.min(99,t+1)),G=()=>I(t=>Math.max(1,t-1)),M=i.useMemo(()=>{const t=g.trim().toLowerCase();return t?a.filter(n=>{var u,m;const c=((u=n.name)==null?void 0:u.toLowerCase())||"",d=((m=n.sku)==null?void 0:m.toLowerCase())||"";return c.includes(t)||d.includes(t)}):a},[a,g]),z=(q=l==null?void 0:l.product)==null?void 0:q.attachmentUrl,E=z?`http://localhost:3000${z}`:"";return e.jsxs("article",{className:"group rounded-md border border-border/60 bg-card text-card-foreground overflow-hidden shadow-sm hover:shadow-md hover:border-border transition-all duration-200 h-full flex flex-col",children:[e.jsxs(_,{to:`/snf/product/${l.product.id}`,className:"block relative aspect-square min-h-[88px] sm:min-h-[96px] bg-muted/30 overflow-hidden",children:[e.jsx("img",{ref:L,src:E&&E.trim().length>0?E:"https://images.unsplash.com/photo-1546470427-0fd2788c37e3?auto=format&fit=crop&w=400&q=80",alt:l.product.name,loading:"lazy",className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-[1.03]"}),P>0&&e.jsxs("div",{className:"absolute left-2 top-2 rounded-full bg-destructive/90 text-white text-xs px-2.5 py-1 shadow-sm font-medium",children:["-",Math.round(P*100),"%"]}),O]}),e.jsxs("div",{className:"p-2 md:p-2.5 space-y-2 md:space-y-2.5 flex-1 flex flex-col",children:[e.jsx("h3",{className:"font-semibold text-[12px] md:text-[13px] leading-tight line-clamp-1 min-h-[1.25rem]",children:e.jsx(_,{to:`/snf/product/${l.product.id}`,className:"hover:text-primary transition-colors",children:l.product.name})}),Q&&e.jsx(e.Fragment,{children:X?e.jsx("div",{className:"flex flex-wrap gap-1 md:gap-1.5",children:a.map(t=>{const n=t.buyOncePrice||t.mrp||0,c=t.id===(r==null?void 0:r.id),d=!t.isHidden&&!t.notInStock;return e.jsxs("button",{onClick:()=>F(t.id),disabled:!d,className:["inline-flex items-center gap-1 rounded-full border px-2 py-1 text-[11px] transition-colors",c?"bg-primary/10 border-primary text-primary":"hover:bg-accent",d?"":"opacity-50 cursor-not-allowed"].join(" "),"aria-pressed":c,children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsxs("span",{className:"text-muted-foreground",children:["₹",n.toFixed(0)]}),!d&&e.jsx("span",{className:"text-muted-foreground",children:"(OOS)"})]},t.id)})}):e.jsxs("div",{className:"relative",ref:k,children:[e.jsxs("button",{onClick:()=>C(t=>!t),className:"w-full flex items-center justify-between px-2 py-1.5 border rounded-md text-[13px] hover:bg-accent transition-colors","aria-expanded":S,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:r?r.name:"Select variant"}),r&&h>0&&e.jsxs("span",{className:"text-muted-foreground",children:["₹",h.toFixed(2)]})]}),e.jsx(se,{className:`h-4 w-4 transition-transform ${S?"rotate-180":""}`})]}),S&&e.jsxs("div",{className:"absolute z-20 w-full mt-1 bg-popover border rounded-md shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-1.5 p-1.5 border-b bg-background",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{value:g,onChange:t=>R(t.target.value),placeholder:"Search variant...",className:"w-full bg-transparent text-sm outline-none"}),g&&e.jsx("button",{className:"p-1 rounded hover:bg-accent",onClick:()=>R(""),"aria-label":"Clear search",children:e.jsx(re,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:M.length===0?e.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"No variants found"}):M.map(t=>{const n=t.buyOncePrice||t.mrp||0,c=t.id===(r==null?void 0:r.id),d=!t.isHidden&&!t.notInStock&&(t.closingQty===void 0||t.closingQty>0),u=t.closingQty!==void 0&&t.closingQty>0&&t.closingQty<=10;return e.jsxs("button",{onClick:()=>F(t.id),disabled:!d,className:["w-full px-2 py-1.5 text-left hover:bg-accent transition-colors flex items-center justify-between",d?"":"opacity-50 cursor-not-allowed",c?"bg-accent":""].join(" "),children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"font-medium text-sm",children:t.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:u?`Only ${t.closingQty} left`:d?"In Stock":"Out of stock"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-semibold",children:["₹",n.toFixed(2)]}),c&&e.jsx(ae,{className:"h-4 w-4 text-primary"})]})]},t.id)})})]})]})}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-sm md:text-base font-semibold",children:["₹",h>0?h.toFixed(2):"N/A"]}),P>0&&f>0&&e.jsxs("span",{className:"text-xs md:text-sm text-muted-foreground line-through",children:["₹",f.toFixed(2)]})]}),e.jsx("div",{className:"mt-auto flex items-stretch w-full relative z-10",children:e.jsxs("div",{className:"flex items-center border rounded-md w-full overflow-hidden",children:[e.jsx("button",{type:"button",className:"px-2 py-1 hover:bg-accent disabled:opacity-50",onClick:t=>{t.stopPropagation(),t.preventDefault(),G()},disabled:y<=1,"aria-label":"Decrease quantity",children:e.jsx(oe,{className:"h-3 w-3"})}),e.jsx("div",{className:"flex-1 min-w-0 text-center text-[12px] md:text-sm font-medium select-none py-1",children:y}),e.jsx("button",{type:"button",className:"px-2 py-1 hover:bg-accent disabled:opacity-50",onClick:t=>{t.stopPropagation(),t.preventDefault(),Y()},"aria-label":"Increase quantity",disabled:(r==null?void 0:r.closingQty)!=null&&r.closingQty>0?y>=r.closingQty:!1,children:e.jsx(le,{className:"h-3 w-3"})})]})}),e.jsx("div",{className:"flex items-center gap-1 pt-1 mt-1",children:e.jsx(ie,{ref:A,className:"flex-1 h-7 text-[12px]",onClick:V,disabled:O,variant:"default",children:"Add to Cart"})})]})]})},ue=({products:l,onAddToCart:N,isLoading:v=!1})=>v?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-x-4 gap-y-6 sm:gap-x-5 sm:gap-y-8",children:Array.from({length:12}).map((x,w)=>e.jsxs("div",{className:"rounded-lg border bg-card text-card-foreground overflow-hidden",children:[e.jsx("div",{className:"aspect-[4/3] bg-muted/30 animate-pulse"}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-3 bg-muted rounded animate-pulse w-3/4"}),e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsx("div",{className:"h-5 bg-muted rounded animate-pulse w-16"}),e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-20"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-8 bg-muted rounded animate-pulse flex-1"}),e.jsx("div",{className:"h-8 bg-muted rounded animate-pulse flex-1"})]})]})]},w))}):e.jsxs("div",{id:"products",className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-x-4 gap-y-6 sm:gap-x-5 sm:gap-y-8",children:[l.map(x=>e.jsx(de,{product:x,onAddToCart:N},x.product.id)),l.length===0&&e.jsx("div",{className:"col-span-full text-center text-muted-foreground py-10",children:"No products found. Try adjusting filters or search."})]});export{ue as P};
