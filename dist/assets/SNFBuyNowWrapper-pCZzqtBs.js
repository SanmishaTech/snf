import{a as ee,b as se,r as c,R as E,t as f,j as e,d as h,e as N,f as g,g as O,h as z,B as y,L as k,i as v,M as ae,P as te,l as ne,k as re,S as le,m as ce}from"./index-DbdoOQ-I.js";import{a as ie,b as de,D as Q,H as M,F as D,P as oe,C as me}from"./Footer-CQgf06Py.js";import{A as xe,s as ue}from"./AddressSelector-CmY6b_zM.js";import{u as he}from"./useProducts-CEx7Vmg1.js";const b=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}),pe=()=>{var W;const[w]=ee(),I=se(),u=w.get("productId"),x=w.get("variantId"),R=parseInt(w.get("quantity")||"1"),{state:H}=ie(),T=(W=H.currentDepot)==null?void 0:W.id,{totalQuantity:C}=de(),{product:d,error:p,isLoading:G}=he(u?parseInt(u):void 0,T||1),[s,V]=c.useState(null),[S,F]=c.useState(!1),[m,J]=c.useState(null),[j,A]=c.useState(0),[K,B]=c.useState(!1),[P,L]=c.useState(null),[o,X]=c.useState(R),i=E.useMemo(()=>!d||!x?null:d.variants.find(t=>t.id===parseInt(x)),[d,x]),n=E.useMemo(()=>{if(!d||!i)return null;const t=i.buyOncePrice||i.mrp||0,a=d.product.attachmentUrl,l=a?`https://www.indraai.in${a}`:void 0;return{productId:d.product.id,variantId:i.id,name:d.product.name,variantName:i.name||"",price:t,quantity:o,imageUrl:l}},[d,i,o]),r=n?n.price*n.quantity:0;c.useEffect(()=>{const t=Q.getCurrentLocation();J(t)},[]),c.useEffect(()=>{(async()=>{B(!0),L(null);try{const a=await ce("/wallet");let l=null;a&&a.data&&typeof a.data.balance=="number"?l=a.data.balance:typeof(a==null?void 0:a.balance)=="number"&&(l=a.balance),A(typeof l=="number"?l:0)}catch(a){console.error("Failed to fetch wallet balance:",a),L((a==null?void 0:a.message)||"Failed to fetch wallet"),A(0)}finally{B(!1)}})()},[]),c.useEffect(()=>{(!u||!x)&&(f.error("Invalid product or variant"),I("/snf"))},[u,x,I]);const U=s!==null&&n!==null,Y=async()=>{if(!(!n||!U||S))try{F(!0);const t=Q.getCurrentDepotId();console.log("[BuyNow Checkout] Using depot ID:",t);const a=[{name:n.name,variantName:n.variantName,imageUrl:n.imageUrl||null,price:n.price,quantity:n.quantity,productId:n.productId,depotProductVariantId:n.variantId}],l=0,Z=Math.max(0,Math.min(j||0,r+l));if(!s){f.error("Please select a delivery address");return}const _={customer:{name:s.recipientName,email:null,mobile:s.mobile,addressLine1:s.plotBuilding,addressLine2:s.streetArea,city:s.city,state:s.state,pincode:s.pincode},items:a,subtotal:r,deliveryFee:l,totalAmount:r+l,walletamt:Z,paymentMode:null,paymentRefNo:null,paymentStatus:"PENDING",paymentDate:null,depotId:t||null,deliveryAddressId:s.id},q=await ue.createOrder(_);f.success(`Order created: ${q.data.orderNo}`),I(`/admin/snf-orders/${q.data.id}`)}catch(t){const a=(t==null?void 0:t.message)||"Failed to create order";f.error(a)}finally{F(!1)}},$=t=>{const a=(i==null?void 0:i.closingQty)||99;X(Math.max(1,Math.min(a,t)))};return G?e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(M,{cartCount:C,onSearch:()=>{}}),e.jsx("main",{className:"flex-1 container mx-auto px-4 md:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-48"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"h-32 bg-muted rounded"})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"h-64 bg-muted rounded"})})]})]})}),e.jsx(D,{})]}):p||!n?e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(M,{cartCount:C,onSearch:()=>{}}),e.jsx("main",{className:"flex-1 container mx-auto px-4 md:px-6 lg:px-8 py-6",children:e.jsxs(h,{children:[e.jsxs(N,{children:[e.jsx(g,{children:"Unable to load product"}),e.jsx(O,{children:(p==null?void 0:p.message)||"Product not found"})]}),e.jsx(z,{children:e.jsx(y,{asChild:!0,children:e.jsx(k,{to:"/snf",children:"Back to products"})})})]})}),e.jsx(D,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(M,{cartCount:C,onSearch:()=>{}}),e.jsx("main",{className:"flex-1",children:e.jsxs("section",{className:"container mx-auto px-4 md:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold",children:"Buy Now"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"• Skip cart, direct checkout"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx(h,{children:e.jsx(v,{className:"py-4",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"size-20 shrink-0 rounded-md overflow-hidden bg-muted/30 grid place-items-center",children:n.imageUrl?e.jsx("img",{src:n.imageUrl,alt:n.name,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"No image"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm md:text-base font-medium",children:n.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.variantName})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 border rounded-md px-2 py-1",children:[e.jsx("button",{className:"p-1 rounded hover:bg-accent",onClick:()=>$(o-1),"aria-label":"Decrease quantity",children:e.jsx(ae,{className:"size-4"})}),e.jsx("span",{className:"text-sm w-6 text-center",children:o}),e.jsx("button",{className:"p-1 rounded hover:bg-accent",onClick:()=>$(o+1),"aria-label":"Increase quantity",children:e.jsx(te,{className:"size-4"})})]}),e.jsx("div",{className:"text-sm md:text-base font-semibold",children:b.format(n.price*o)})]})]})]})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{asChild:!0,variant:"outline",children:e.jsx(k,{to:`/snf/product/${u}?variant=${x}`,children:"Back to product"})}),e.jsx(y,{asChild:!0,variant:"outline",children:e.jsx(k,{to:"/snf",children:"Continue shopping"})})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs(h,{className:m&&m.depotName?"border-green-200":"border-yellow-200",children:[e.jsx(N,{className:"pb-2",children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"size-4"}),"Delivery Location"]})}),e.jsx(v,{children:m&&m.depotName?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Pincode:"}),e.jsx("span",{children:m.pincode})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Depot:"}),e.jsx("span",{children:m.depotName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Area:"}),e.jsx("span",{children:m.areaName})]}),e.jsxs("div",{className:"text-xs text-green-600 mt-2 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-600 rounded-full"}),"Service available"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-yellow-700 flex items-start gap-2",children:[e.jsx(re,{className:"size-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Please set your delivery location in the header to see depot information."})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Orders will be assigned to the default depot if no location is selected."})]})})]}),e.jsx(xe,{selectedAddressId:s==null?void 0:s.id,onAddressSelect:V}),s&&e.jsxs(h,{className:"border-green-200 bg-green-50/30",children:[e.jsx(N,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-green-800",children:"Selected Delivery Address"})}),e.jsx(v,{className:"text-sm",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:s.recipientName}),e.jsxs("p",{className:"text-muted-foreground",children:[s.plotBuilding,s.plotBuilding&&s.streetArea?", ":"",s.streetArea]}),s.landmark&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Landmark: ",s.landmark]}),e.jsxs("p",{className:"text-muted-foreground",children:[s.city,", ",s.state," - ",s.pincode]}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Mobile: ",s.mobile]})]})})]}),e.jsxs(h,{children:[e.jsxs(N,{className:"pb-2",children:[e.jsx(g,{children:"Order Summary"}),e.jsxs(O,{children:["1 item • ",o," ",o===1?"unit":"units"]})]}),e.jsxs(v,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:b.format(r)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery"}),e.jsx("span",{className:"font-medium",children:"₹0"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Wallet deduction"}),e.jsxs("span",{className:"font-medium text-green-600",children:["-",K?"...":b.format(Math.max(0,Math.min(j||0,r)))]})]}),e.jsx(le,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Amount payable"}),e.jsx("span",{className:"font-semibold",children:(()=>{const t=Math.max(0,Math.min(j||0,r));return b.format(Math.max(0,r-t))})()})]}),P&&e.jsx("p",{className:"text-xs text-destructive",children:P}),!P&&e.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{const t=Math.max(0,Math.min(j||0,r)),a=Math.max(0,r-t);return t>0&&a>0?`₹${t.toFixed(0)} will be deducted from your wallet. Remaining ₹${a.toFixed(0)} to be collected via Cash/UPI before delivery.`:t>=r&&r>0?`Full amount of ₹${r.toFixed(0)} will be deducted from your wallet.`:"No wallet balance applied."})()})]}),e.jsxs(z,{className:"flex-col gap-2",children:[e.jsx(y,{className:"w-full",onClick:Y,disabled:!U||S,children:S?"Placing order...":"Proceed to payment"}),!s&&e.jsx("p",{className:"text-xs text-red-600 text-center",children:"Please select a delivery address to continue"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"By placing your order, you agree to our terms and policies."})]})]})]})]})]})}),e.jsx(D,{})]})},ye=()=>e.jsx(oe,{children:e.jsx(me,{children:e.jsx(pe,{})})});export{ye as default};
