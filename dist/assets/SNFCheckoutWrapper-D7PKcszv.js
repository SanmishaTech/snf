import{p as G,b as Q,r as i,j as e,e as u,f as j,g,h as I,i as q,B as f,k as N,T as Y,M as J,P as K,L as X,l as Z,m as _,n as c,I as d,o as ee,q as se,t as W}from"./index-CbLoiRZv.js";import{a as ae,D as z,H as te,F as le,P as ne,C as re}from"./Footer-Cb69ot-i.js";const ie={createOrder:r=>G("/snf-orders",r)},v=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}),ce=()=>{const{state:r,subtotal:l,increment:A,decrement:O,removeItem:U,clear:L}=ae(),y=r.items.reduce((s,a)=>s+a.quantity,0),$=Q(),[t,n]=i.useState({name:"",email:"",mobile:"",addressLine1:"",addressLine2:"",city:"",state:"",pincode:""}),[b,P]=i.useState(!1),[m,B]=i.useState(null),[p,S]=i.useState(0),[R,D]=i.useState(!1),[C,M]=i.useState(null);i.useEffect(()=>{const s=z.getCurrentLocation();B(s),s!=null&&s.pincode&&n(a=>({...a,pincode:s.pincode}))},[]),i.useEffect(()=>{(async()=>{D(!0),M(null);try{const a=await se("/wallet");let o=null;a&&a.data&&typeof a.data.balance=="number"?o=a.data.balance:typeof(a==null?void 0:a.balance)=="number"&&(o=a.balance),S(typeof o=="number"?o:0)}catch(a){console.error("Failed to fetch wallet balance:",a),M((a==null?void 0:a.message)||"Failed to fetch wallet"),S(0)}finally{D(!1)}})()},[]);const k=t.name.trim()!==""&&t.mobile.trim()!==""&&t.addressLine1.trim()!==""&&t.city.trim()!==""&&t.pincode.trim()!=="",T=async()=>{var s,a,o;if(!(r.items.length===0||!k||b))try{P(!0);const h=z.getCurrentDepotId();console.log("[Checkout] Using depot ID:",h);const w=r.items.map(x=>({name:x.name,variantName:x.variantName,imageUrl:x.imageUrl||null,price:x.price,quantity:x.quantity,productId:x.productId,depotProductVariantId:x.variantId})),F=0,H=Math.max(0,Math.min(p||0,l+F)),V={customer:{name:t.name.trim(),email:((s=t.email)==null?void 0:s.trim())||null,mobile:t.mobile.trim(),addressLine1:t.addressLine1.trim(),addressLine2:((a=t.addressLine2)==null?void 0:a.trim())||null,city:t.city.trim(),state:((o=t.state)==null?void 0:o.trim())||null,pincode:t.pincode.trim()},items:w,subtotal:l,deliveryFee:F,totalAmount:l+F,walletamt:H,paymentMode:null,paymentRefNo:null,paymentStatus:"PENDING",paymentDate:null,depotId:h||null},E=await ie.createOrder(V);W.success(`Order created: ${E.data.orderNo}`),L(),$(`/admin/snf-orders/${E.data.id}`)}catch(h){const w=(h==null?void 0:h.message)||"Failed to create order";W.error(w)}finally{P(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(te,{cartCount:y,onSearch:()=>{}}),e.jsx("main",{className:"flex-1",children:e.jsxs("section",{className:"container mx-auto px-4 md:px-6 lg:px-8 py-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold mb-4",children:"Checkout"}),r.items.length===0?e.jsxs(u,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Your cart is empty"}),e.jsx(I,{children:"Add some products to continue"})]}),e.jsx(q,{children:e.jsx(f,{asChild:!0,children:e.jsx("a",{href:"/snf",children:"Continue shopping"})})})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[r.items.map(s=>e.jsx(u,{children:e.jsx(N,{className:"py-4",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"size-20 shrink-0 rounded-md overflow-hidden bg-muted/30 grid place-items-center",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"No image"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm md:text-base font-medium truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.variantName})]}),e.jsx("button",{className:"p-2 rounded hover:bg-accent",onClick:()=>U(s.variantId),"aria-label":`Remove ${s.name}`,children:e.jsx(Y,{className:"size-4"})})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 border rounded-md px-2 py-1",children:[e.jsx("button",{className:"p-1 rounded hover:bg-accent",onClick:()=>O(s.variantId),"aria-label":"Decrease quantity",children:e.jsx(J,{className:"size-4"})}),e.jsx("span",{className:"text-sm w-6 text-center",children:s.quantity}),e.jsx("button",{className:"p-1 rounded hover:bg-accent",onClick:()=>A(s.variantId),"aria-label":"Increase quantity",children:e.jsx(K,{className:"size-4"})})]}),e.jsx("div",{className:"text-sm md:text-base font-semibold",children:v.format(s.price*s.quantity)})]})]})]})})},s.variantId)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",onClick:L,children:"Clear cart"}),e.jsx(f,{asChild:!0,variant:"outline",children:e.jsx(X,{to:"/snf",children:"Continue shopping"})})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs(u,{className:m&&m.depotName?"border-green-200":"border-yellow-200",children:[e.jsx(j,{className:"pb-2",children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"size-4"}),"Delivery Location"]})}),e.jsx(N,{children:m&&m.depotName?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Pincode:"}),e.jsx("span",{children:m.pincode})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Depot:"}),e.jsx("span",{children:m.depotName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Area:"}),e.jsx("span",{children:m.areaName})]}),e.jsxs("div",{className:"text-xs text-green-600 mt-2 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-600 rounded-full"}),"Service available"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-yellow-700 flex items-start gap-2",children:[e.jsx(_,{className:"size-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Please set your delivery location in the header to see depot information."})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Orders will be assigned to the default depot if no location is selected."})]})})]}),e.jsxs(u,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Customer Details"}),e.jsx(I,{children:"Enter shipping/contact details"})]}),e.jsxs(N,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"name",children:"Full Name *"}),e.jsx(d,{id:"name",value:t.name,onChange:s=>n(a=>({...a,name:s.target.value}))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"mobile",children:"Mobile *"}),e.jsx(d,{id:"mobile",type:"tel",value:t.mobile,onChange:s=>n(a=>({...a,mobile:s.target.value}))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(d,{id:"email",type:"email",value:t.email,onChange:s=>n(a=>({...a,email:s.target.value}))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"address1",children:"Address Line 1 *"}),e.jsx(d,{id:"address1",value:t.addressLine1,onChange:s=>n(a=>({...a,addressLine1:s.target.value}))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"address2",children:"Address Line 2"}),e.jsx(d,{id:"address2",value:t.addressLine2,onChange:s=>n(a=>({...a,addressLine2:s.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"city",children:"City *"}),e.jsx(d,{id:"city",value:t.city,onChange:s=>n(a=>({...a,city:s.target.value}))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"state",children:"State"}),e.jsx(d,{id:"state",value:t.state,onChange:s=>n(a=>({...a,state:s.target.value}))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"pincode",children:"Pincode *"}),e.jsx(d,{id:"pincode",value:t.pincode,onChange:s=>n(a=>({...a,pincode:s.target.value}))})]})]})]})]}),e.jsxs(u,{children:[e.jsxs(j,{className:"pb-2",children:[e.jsx(g,{children:"Order Summary"}),e.jsxs(I,{children:[y," item",y!==1?"s":""]})]}),e.jsxs(N,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:v.format(l)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery"}),e.jsx("span",{className:"font-medium",children:"₹0"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Wallet deduction"}),e.jsxs("span",{className:"font-medium text-green-600",children:["-",R?"...":v.format(Math.max(0,Math.min(p||0,l)))]})]}),e.jsx(ee,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Amount payable"}),e.jsx("span",{className:"font-semibold",children:(()=>{const s=Math.max(0,Math.min(p||0,l));return v.format(Math.max(0,l-s))})()})]}),C&&e.jsx("p",{className:"text-xs text-destructive",children:C}),!C&&e.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{const s=Math.max(0,Math.min(p||0,l)),a=Math.max(0,l-s);return s>0&&a>0?`₹${s.toFixed(0)} will be deducted from your wallet. Remaining ₹${a.toFixed(0)} to be collected via Cash/UPI before delivery.`:s>=l&&l>0?`Full amount of ₹${l.toFixed(0)} will be deducted from your wallet.`:"No wallet balance applied."})()})]}),e.jsxs(q,{className:"flex-col gap-2",children:[e.jsx(f,{className:"w-full",onClick:T,disabled:r.items.length===0||!k||b,children:b?"Placing order...":"Proceed to payment"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"By placing your order, you agree to our terms and policies."})]})]})]})]})]})}),e.jsx(le,{})]})},oe=()=>e.jsx(ne,{children:e.jsx(re,{children:e.jsx(ce,{})})});export{oe as default};
