import{r as d,j as t,L as _,a7 as ae,a4 as le,aa as ie,C as ce,M as de,P as me,B as ue}from"./index-Di9k1Ec8.js";const U=1,pe=4,fe=({product:i,onAddToCart:X,initialVariantId:Y=null,showVariants:y=!0})=>{var T;const[v,G]=d.useState(Y),[S,C]=d.useState(!1),[g,I]=d.useState(""),[b,O]=d.useState(1),k=d.useRef(null),D=d.useRef(null),A=d.useRef(null);d.useEffect(()=>{const e=o=>{k.current&&!k.current.contains(o.target)&&C(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const r=i.variants??[],P=d.useMemo(()=>r.length>0?r.filter(e=>!e.isHidden&&!e.notInStock):[],[r]),n=d.useMemo(()=>v?r.find(e=>e.id===v)??P[0]??r[0]:P[0]??r[0],[v,P,r]),p=d.useMemo(()=>{if(n)return n.buyOncePrice||n.mrp||0;if(r&&r.length>0){const e=r.filter(o=>!o.isHidden&&!o.notInStock).map(o=>o.buyOncePrice||o.mrp||0).filter(o=>typeof o=="number"&&isFinite(o)&&o>0);return e.length>0?Math.min(...e):0}return 0},[n,r]),h=(n==null?void 0:n.mrp)||0,$=h>p?(h-p)/h:0,L=!1,R=y&&((r==null?void 0:r.length)||0)>0,j=y&&((r==null?void 0:r.length)||0)>1,J=R&&r.length<=pe,Q=e=>{G(e),C(!1)},K=()=>{const e=n||{id:0,name:"Default",buyOncePrice:i.buyOncePrice,mrp:i.mrp,productId:i.product.id,depotId:U,hsnCode:"",minimumQty:1,closingQty:999,notInStock:!1,isHidden:!1,createdAt:new Date,updatedAt:new Date,depot:{id:U,name:"Default Depot",address:"",isOnline:!0},product:i.product};X(i,e,b);try{const o=D.current,a=A.current,c=document.getElementById("snf-cart-button");if(!a||!c)return;const x=a.style.transform,f=a.style.transition;a.style.transition=`${f?f+", ":""}transform 120ms ease`,a.style.transform="scale(0.97)",setTimeout(()=>{a.style.transform=x,a.style.transition=f},140);const m=a.getBoundingClientRect(),u=c.getBoundingClientRect(),s=document.createElement("img");s.src=(o==null?void 0:o.src)||"",s.setAttribute("aria-hidden","true");const N=56;s.style.position="fixed",s.style.left=`${m.left+m.width/2-N/2}px`,s.style.top=`${m.top+m.height/2-N/2}px`,s.style.width=`${N}px`,s.style.height=`${N}px`,s.style.objectFit="cover",s.style.zIndex="9999",s.style.borderRadius="8px",s.style.pointerEvents="none",s.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)",document.body.appendChild(s);const q=u.left+u.width/2-(m.left+m.width/2),z=u.top+u.height/2-(m.top+m.height/2),V=q*.2,ee=z*.2-20;s.style.transition="transform 180ms ease-out, opacity 180ms ease-out",s.style.transform="translate(0px, 0px) scale(0.9)",s.style.opacity="0.9",requestAnimationFrame(()=>{s.style.transform=`translate(${V}px, ${ee}px) scale(1.02)`});const H=te=>{if(te.propertyName!=="transform")return;s.removeEventListener("transitionend",H),s.style.transition="transform 520ms cubic-bezier(0.22, 1, 0.36, 1), opacity 520ms ease",s.style.transform=`translate(${q}px, ${z}px) scale(0.4) rotate(8deg)`,s.style.opacity="0.25";const B=se=>{if(se.propertyName!=="transform")return;s.removeEventListener("transitionend",B);const ne=getComputedStyle(c).color,l=document.createElement("span"),oe=u.left+u.width/2,re=u.top+u.height/2,w=14;l.style.position="fixed",l.style.left=`${oe-w}px`,l.style.top=`${re-w}px`,l.style.width=`${w*2}px`,l.style.height=`${w*2}px`,l.style.border=`2px solid ${ne}`,l.style.borderRadius="9999px",l.style.opacity="0.5",l.style.pointerEvents="none",l.style.zIndex="9999",l.style.transform="scale(0.4)",l.style.transition="transform 420ms ease, opacity 420ms ease",document.body.appendChild(l),requestAnimationFrame(()=>{l.style.transform="scale(1.8)",l.style.opacity="0"}),setTimeout(()=>l.remove(),460),s&&s.parentNode&&s.parentNode.removeChild(s)};s.addEventListener("transitionend",B)};s.addEventListener("transitionend",H)}catch{}},W=()=>O(e=>Math.min(99,e+1)),Z=()=>O(e=>Math.max(1,e-1)),F=d.useMemo(()=>{const e=g.trim().toLowerCase();return e?r.filter(o=>{var x,f;const a=((x=o.name)==null?void 0:x.toLowerCase())||"",c=((f=o.sku)==null?void 0:f.toLowerCase())||"";return a.includes(e)||c.includes(e)}):r},[r,g]),M=(T=i==null?void 0:i.product)==null?void 0:T.attachmentUrl,E=M?`https://snf.3.7.237.251.sslip.io${M}`:"";return t.jsxs("article",{className:"group rounded-2xl border bg-card text-card-foreground overflow-hidden shadow-sm hover:shadow-md transition-all duration-200 h-full flex flex-col",children:[t.jsxs(_,{to:`/snf/product/${i.product.id}`,className:"block relative aspect-square min-h-[88px] sm:min-h-[96px] bg-muted/30 overflow-hidden rounded-b-none",children:[t.jsx("img",{ref:D,src:E&&E.trim().length>0?E:"https://images.unsplash.com/photo-1546470427-0fd2788c37e3?auto=format&fit=crop&w=400&q=80",alt:i.product.name,loading:"lazy",className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-[1.03]"}),y&&$>0&&t.jsxs("div",{className:"absolute left-2 top-2 rounded-full bg-destructive/90 text-white text-xs px-2.5 py-1 shadow-sm font-medium",children:["-",Math.round($*100),"%"]}),L]}),t.jsxs("div",{className:"p-2.5 space-y-2.5 flex-1 flex flex-col",children:[t.jsx("h3",{className:"font-semibold text-[12px] md:text-[13px] leading-tight line-clamp-1 min-h-[1.25rem]",children:t.jsx(_,{to:`/snf/product/${i.product.id}`,className:"hover:text-primary transition-colors",children:i.product.name})}),R&&t.jsx(t.Fragment,{children:J?t.jsx("div",{className:"flex flex-wrap gap-1 md:gap-1.5",children:r.map(e=>{const o=e.buyOncePrice||e.mrp||0,a=e.id===(n==null?void 0:n.id),c=!e.isHidden&&!e.notInStock;return t.jsxs("button",{onClick:()=>Q(e.id),disabled:!c||!j,className:["inline-flex items-center gap-1 rounded-full border px-2.5 py-1 text-[11px] transition-colors shadow-sm",a?"bg-primary/10 border-primary text-primary":j?"hover:bg-accent":"bg-accent/50",c?"":"opacity-50 cursor-not-allowed",j?"":"cursor-default"].join(" "),"aria-pressed":a,children:[t.jsx("span",{className:"font-medium",children:e.name}),t.jsxs("span",{className:"text-muted-foreground",children:["₹",o.toFixed(0)]}),!c&&t.jsx("span",{className:"text-muted-foreground",children:"(OOS)"})]},e.id)})}):j?t.jsxs("div",{className:"relative",ref:k,children:[t.jsxs("button",{onClick:()=>C(e=>!e),className:"w-full flex items-center justify-between px-2.5 py-1.5 border rounded-md text-[13px] hover:bg-accent transition-colors shadow-sm","aria-expanded":S,children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium",children:n?n.name:"Select variant"}),n&&p>0&&t.jsxs("span",{className:"text-muted-foreground",children:["₹",p.toFixed(2)]})]}),t.jsx(ae,{className:`h-4 w-4 transition-transform ${S?"rotate-180":""}`})]}),S&&t.jsxs("div",{className:"absolute z-20 w-full mt-1 bg-popover border rounded-md shadow-lg overflow-hidden",children:[t.jsxs("div",{className:"flex items-center gap-1.5 p-1.5 border-b bg-background",children:[t.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),t.jsx("input",{value:g,onChange:e=>I(e.target.value),placeholder:"Search variant...",className:"w-full bg-transparent text-sm outline-none"}),g&&t.jsx("button",{className:"p-1 rounded hover:bg-accent",onClick:()=>I(""),"aria-label":"Clear search",children:t.jsx(ie,{className:"h-4 w-4"})})]}),t.jsx("div",{className:"max-h-48 overflow-y-auto",children:F.length===0?t.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"No variants found"}):F.map(e=>{const o=e.buyOncePrice||e.mrp||0,a=e.id===(n==null?void 0:n.id),c=!e.isHidden&&!e.notInStock&&(e.closingQty===void 0||e.closingQty>0),x=e.closingQty!==void 0&&e.closingQty>0&&e.closingQty<=10;return t.jsxs("button",{onClick:()=>Q(e.id),disabled:!c,className:["w-full px-2 py-1.5 text-left hover:bg-accent transition-colors flex items-center justify-between",c?"":"opacity-50 cursor-not-allowed",a?"bg-accent":""].join(" "),children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsx("span",{className:"font-medium text-sm",children:e.name}),t.jsx("span",{className:"text-xs text-muted-foreground",children:x?`Only ${e.closingQty} left`:c?"In Stock":"Out of stock"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-sm font-semibold",children:["₹",o.toFixed(2)]}),a&&t.jsx(ce,{className:"h-4 w-4 text-primary"})]})]},e.id)})})]})]}):t.jsx("div",{className:"flex flex-wrap gap-1 md:gap-1.5",children:n&&t.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border px-2.5 py-1 text-[11px] bg-accent/50 cursor-default",children:[t.jsx("span",{className:"font-medium",children:n.name}),t.jsxs("span",{className:"text-muted-foreground",children:["₹",p.toFixed(0)]})]})})}),t.jsxs("div",{className:"flex items-baseline gap-1",children:[t.jsxs("span",{className:"text-sm md:text-base font-semibold",children:["₹",p>0?p.toFixed(2):"N/A"]}),y&&$>0&&h>0&&t.jsxs("span",{className:"text-xs md:text-sm text-muted-foreground line-through",children:["₹",h.toFixed(2)]})]}),t.jsx("div",{className:"mt-auto flex items-stretch w-full relative z-10",children:t.jsxs("div",{className:"flex items-center border rounded-full w-full overflow-hidden bg-background/60 shadow-inner",children:[t.jsx("button",{type:"button",className:"px-3 py-2 hover:bg-accent disabled:opacity-50",onClick:e=>{e.stopPropagation(),e.preventDefault(),Z()},disabled:b<=1,"aria-label":"Decrease quantity",children:t.jsx(de,{className:"h-3.5 w-3.5"})}),t.jsx("div",{className:"flex-1 min-w-0 text-center text-[12px] md:text-sm font-medium select-none py-1.5",children:b}),t.jsx("button",{type:"button",className:"px-3 py-2 hover:bg-accent disabled:opacity-50",onClick:e=>{e.stopPropagation(),e.preventDefault(),W()},"aria-label":"Increase quantity",disabled:(n==null?void 0:n.closingQty)!=null&&n.closingQty>0?b>=n.closingQty:!1,children:t.jsx(me,{className:"h-3.5 w-3.5"})})]})}),t.jsx("div",{className:"flex items-center gap-1.5 pt-1 mt-1",children:t.jsx(ue,{ref:A,className:"flex-1 h-9 rounded-full text-[12px] shadow-sm",onClick:K,disabled:L,variant:"default",children:"Add to Cart"})})]})]})};export{fe as P};
