import{r as f,U as _e,j as e,V as Be,W as ze,X,Y as ee,Z as q,_ as Oe,$ as Ce,a0 as Ve,a1 as He,a2 as oe,d as Ke,e as Qe,f as Ue,a3 as me,A as z,B as I,i as Ye,z as H,a4 as Xe,I as ie,a5 as ce,a6 as le,a7 as de,a8 as ue,a9 as je,aa as U,a as Ge,u as Je,F as qe,ab as Ze,ac as We,ad as et,ae as tt,af as at,ag as st,ah as rt,ai as we}from"./index-Di9k1Ec8.js";import{u as nt,b as ot,a as it,H as ct,F as lt,p as dt,P as ut,C as mt}from"./Footer-Bx9jF1vN.js";import{P as gt}from"./ProductGrid-CzWKxcJF.js";import{a as ht}from"./useProducts-H3kSo0Ko.js";import"./ProductCard-CL3Tnloo.js";var Se=["PageUp","PageDown"],Pe=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Re={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},G="Slider",[ge,ft,pt]=ze(G),[De,Kt]=Be(G,[pt]),[xt,te]=De(G),ke=f.forwardRef((a,s)=>{const{name:o,min:t=0,max:n=100,step:m=1,orientation:d="horizontal",disabled:g=!1,minStepsBetweenThumbs:p=0,defaultValue:C=[t],value:k,onValueChange:u=()=>{},onValueCommit:y=()=>{},inverted:i=!1,form:x,...v}=a,b=f.useRef(new Set),h=f.useRef(0),E=d==="horizontal"?bt:yt,[P=[],O]=_e({prop:k,defaultProp:C,onChange:M=>{var r;(r=[...b.current][h.current])==null||r.focus(),u(M)}}),B=f.useRef(P);function V(M){const c=Ct(P,M);Q(M,c)}function ae(M){Q(M,h.current)}function K(){const M=B.current[h.current];P[h.current]!==M&&y(P)}function Q(M,c,{commit:r}={commit:!1}){const l=Dt(m),D=kt(Math.round((M-t)/m)*m+t,l),S=Ce(D,[t,n]);O((A=[])=>{const $=wt(A,S,c);if(Rt($,p*m)){h.current=$.indexOf(S);const R=String($)!==String(A);return R&&r&&y($),R?$:A}else return A})}return e.jsx(xt,{scope:a.__scopeSlider,name:o,disabled:g,min:t,max:n,valueIndexToChangeRef:h,thumbs:b.current,values:P,orientation:d,form:x,children:e.jsx(ge.Provider,{scope:a.__scopeSlider,children:e.jsx(ge.Slot,{scope:a.__scopeSlider,children:e.jsx(E,{"aria-disabled":g,"data-disabled":g?"":void 0,...v,ref:s,onPointerDown:X(v.onPointerDown,()=>{g||(B.current=P)}),min:t,max:n,inverted:i,onSlideStart:g?void 0:V,onSlideMove:g?void 0:ae,onSlideEnd:g?void 0:K,onHomeKeyDown:()=>!g&&Q(t,0,{commit:!0}),onEndKeyDown:()=>!g&&Q(n,P.length-1,{commit:!0}),onStepKeyDown:({event:M,direction:c})=>{if(!g){const D=Se.includes(M.key)||M.shiftKey&&Pe.includes(M.key)?10:1,S=h.current,A=P[S],$=m*D*c;Q(A+$,S,{commit:!0})}}})})})})});ke.displayName=G;var[Me,Ae]=De(G,{startEdge:"left",endEdge:"right",size:"width",direction:1}),bt=f.forwardRef((a,s)=>{const{min:o,max:t,dir:n,inverted:m,onSlideStart:d,onSlideMove:g,onSlideEnd:p,onStepKeyDown:C,...k}=a,[u,y]=f.useState(null),i=q(s,E=>y(E)),x=f.useRef(void 0),v=Oe(n),b=v==="ltr",h=b&&!m||!b&&m;function _(E){const P=x.current||u.getBoundingClientRect(),O=[0,P.width],V=pe(O,h?[o,t]:[t,o]);return x.current=P,V(E-P.left)}return e.jsx(Me,{scope:a.__scopeSlider,startEdge:h?"left":"right",endEdge:h?"right":"left",direction:h?1:-1,size:"width",children:e.jsx(Ee,{dir:v,"data-orientation":"horizontal",...k,ref:i,style:{...k.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:E=>{const P=_(E.clientX);d==null||d(P)},onSlideMove:E=>{const P=_(E.clientX);g==null||g(P)},onSlideEnd:()=>{x.current=void 0,p==null||p()},onStepKeyDown:E=>{const O=Re[h?"from-left":"from-right"].includes(E.key);C==null||C({event:E,direction:O?-1:1})}})})}),yt=f.forwardRef((a,s)=>{const{min:o,max:t,inverted:n,onSlideStart:m,onSlideMove:d,onSlideEnd:g,onStepKeyDown:p,...C}=a,k=f.useRef(null),u=q(s,k),y=f.useRef(void 0),i=!n;function x(v){const b=y.current||k.current.getBoundingClientRect(),h=[0,b.height],E=pe(h,i?[t,o]:[o,t]);return y.current=b,E(v-b.top)}return e.jsx(Me,{scope:a.__scopeSlider,startEdge:i?"bottom":"top",endEdge:i?"top":"bottom",size:"height",direction:i?1:-1,children:e.jsx(Ee,{"data-orientation":"vertical",...C,ref:u,style:{...C.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:v=>{const b=x(v.clientY);m==null||m(b)},onSlideMove:v=>{const b=x(v.clientY);d==null||d(b)},onSlideEnd:()=>{y.current=void 0,g==null||g()},onStepKeyDown:v=>{const h=Re[i?"from-bottom":"from-top"].includes(v.key);p==null||p({event:v,direction:h?-1:1})}})})}),Ee=f.forwardRef((a,s)=>{const{__scopeSlider:o,onSlideStart:t,onSlideMove:n,onSlideEnd:m,onHomeKeyDown:d,onEndKeyDown:g,onStepKeyDown:p,...C}=a,k=te(G,o);return e.jsx(ee.span,{...C,ref:s,onKeyDown:X(a.onKeyDown,u=>{u.key==="Home"?(d(u),u.preventDefault()):u.key==="End"?(g(u),u.preventDefault()):Se.concat(Pe).includes(u.key)&&(p(u),u.preventDefault())}),onPointerDown:X(a.onPointerDown,u=>{const y=u.target;y.setPointerCapture(u.pointerId),u.preventDefault(),k.thumbs.has(y)?y.focus():t(u)}),onPointerMove:X(a.onPointerMove,u=>{u.target.hasPointerCapture(u.pointerId)&&n(u)}),onPointerUp:X(a.onPointerUp,u=>{const y=u.target;y.hasPointerCapture(u.pointerId)&&(y.releasePointerCapture(u.pointerId),m(u))})})}),$e="SliderTrack",Ie=f.forwardRef((a,s)=>{const{__scopeSlider:o,...t}=a,n=te($e,o);return e.jsx(ee.span,{"data-disabled":n.disabled?"":void 0,"data-orientation":n.orientation,...t,ref:s})});Ie.displayName=$e;var he="SliderRange",Fe=f.forwardRef((a,s)=>{const{__scopeSlider:o,...t}=a,n=te(he,o),m=Ae(he,o),d=f.useRef(null),g=q(s,d),p=n.values.length,C=n.values.map(y=>Te(y,n.min,n.max)),k=p>1?Math.min(...C):0,u=100-Math.max(...C);return e.jsx(ee.span,{"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,...t,ref:g,style:{...a.style,[m.startEdge]:k+"%",[m.endEdge]:u+"%"}})});Fe.displayName=he;var fe="SliderThumb",Le=f.forwardRef((a,s)=>{const o=ft(a.__scopeSlider),[t,n]=f.useState(null),m=q(s,g=>n(g)),d=f.useMemo(()=>t?o().findIndex(g=>g.ref.current===t):-1,[o,t]);return e.jsx(vt,{...a,ref:m,index:d})}),vt=f.forwardRef((a,s)=>{const{__scopeSlider:o,index:t,name:n,...m}=a,d=te(fe,o),g=Ae(fe,o),[p,C]=f.useState(null),k=q(s,_=>C(_)),u=p?d.form||!!p.closest("form"):!0,y=Ve(p),i=d.values[t],x=i===void 0?0:Te(i,d.min,d.max),v=Nt(t,d.values.length),b=y==null?void 0:y[g.size],h=b?St(b,x,g.direction):0;return f.useEffect(()=>{if(p)return d.thumbs.add(p),()=>{d.thumbs.delete(p)}},[p,d.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[g.startEdge]:`calc(${x}% + ${h}px)`},children:[e.jsx(ge.ItemSlot,{scope:a.__scopeSlider,children:e.jsx(ee.span,{role:"slider","aria-label":a["aria-label"]||v,"aria-valuemin":d.min,"aria-valuenow":i,"aria-valuemax":d.max,"aria-orientation":d.orientation,"data-orientation":d.orientation,"data-disabled":d.disabled?"":void 0,tabIndex:d.disabled?void 0:0,...m,ref:k,style:i===void 0?{display:"none"}:a.style,onFocus:X(a.onFocus,()=>{d.valueIndexToChangeRef.current=t})})}),u&&e.jsx(jt,{name:n??(d.name?d.name+(d.values.length>1?"[]":""):void 0),form:d.form,value:i},t)]})});Le.displayName=fe;var jt=a=>{const{value:s,...o}=a,t=f.useRef(null),n=He(s);return f.useEffect(()=>{const m=t.current,d=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(d,"value").set;if(n!==s&&p){const C=new Event("input",{bubbles:!0});p.call(m,s),m.dispatchEvent(C)}},[n,s]),e.jsx("input",{style:{display:"none"},...o,ref:t,defaultValue:s})};function wt(a=[],s,o){const t=[...a];return t[o]=s,t.sort((n,m)=>n-m)}function Te(a,s,o){const m=100/(o-s)*(a-s);return Ce(m,[0,100])}function Nt(a,s){return s>2?`Value ${a+1} of ${s}`:s===2?["Minimum","Maximum"][a]:void 0}function Ct(a,s){if(a.length===1)return 0;const o=a.map(n=>Math.abs(n-s)),t=Math.min(...o);return o.indexOf(t)}function St(a,s,o){const t=a/2,m=pe([0,50],[0,t]);return(t-m(s)*o)*o}function Pt(a){return a.slice(0,-1).map((s,o)=>a[o+1]-s)}function Rt(a,s){if(s>0){const o=Pt(a);return Math.min(...o)>=s}return!0}function pe(a,s){return o=>{if(a[0]===a[1]||s[0]===s[1])return s[0];const t=(s[1]-s[0])/(a[1]-a[0]);return s[0]+t*(o-a[0])}}function Dt(a){return(String(a).split(".")[1]||"").length}function kt(a,s){const o=Math.pow(10,s);return Math.round(a*o)/o}var Mt=ke,At=Ie,Et=Fe,$t=Le;function It({className:a,defaultValue:s,value:o,min:t=0,max:n=100,...m}){const d=f.useMemo(()=>Array.isArray(o)?o:Array.isArray(s)?s:[t,n],[o,s,t,n]);return e.jsxs(Mt,{"data-slot":"slider",defaultValue:s,value:o,min:t,max:n,className:oe("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",a),...m,children:[e.jsx(At,{"data-slot":"slider-track",className:oe("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:e.jsx(Et,{"data-slot":"slider-range",className:oe("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:d.length},(g,p)=>e.jsx($t,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},p))]})}const Ft=["Fruits & Vegetables","Dairy & Eggs","Meat & Seafood","Bakery","Beverages","Snacks","Frozen Foods","Personal Care","Household","Baby Care"],Lt=["Amul","Britannia","Nestle","ITC","Parle","Haldiram's","MTR","Organic India","24 Mantra","Fresho"];function Ne({filters:a,onFiltersChange:s,onClearAll:o,categories:t,brands:n}){const m=(t==null?void 0:t.map(i=>i.name))||Ft,d=n||Lt,[g,p]=f.useState({categories:!0,brands:!0,price:!0,rating:!0,discount:!1,availability:!1}),C=i=>{p(x=>({...x,[i]:!x[i]}))},k=(i,x)=>{const v=x?[...a.categories,i]:a.categories.filter(b=>b!==i);s({...a,categories:v})},u=(i,x)=>{const v=x?[...a.brands,i]:a.brands.filter(b=>b!==i);s({...a,brands:v})},y=a.categories.length+a.brands.length+a.availability.length+(a.rating>0?1:0)+(a.discount>0?1:0)+(a.priceRange[0]>0||a.priceRange[1]<1e4?1:0);return e.jsxs(Ke,{className:"w-full max-w-sm",children:[e.jsx(Qe,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ue,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Filters",y>0&&e.jsx(z,{variant:"secondary",className:"ml-2",children:y})]}),y>0&&e.jsx(I,{variant:"ghost",size:"sm",onClick:o,children:"Clear All"})]})}),e.jsxs(Ye,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"search",children:"Search Products"}),e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{id:"search",placeholder:"Search for products...",value:a.searchQuery,onChange:i=>s({...a,searchQuery:i.target.value}),className:"pl-10"})]})]}),e.jsxs(ce,{open:g.categories,onOpenChange:()=>C("categories"),children:[e.jsxs(le,{className:"flex w-full items-center justify-between py-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Categories"}),e.jsx(de,{className:`h-4 w-4 transition-transform ${g.categories?"rotate-180":""}`})]}),e.jsx(ue,{className:"space-y-3 pt-2",children:e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:m.map(i=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{id:`category-${i}`,checked:a.categories.includes(i),onCheckedChange:x=>k(i,x),className:"h-4 w-4 md:h-5 md:w-5"}),e.jsx(H,{htmlFor:`category-${i}`,className:"text-sm font-normal",children:i})]},i))})})]}),e.jsxs(ce,{open:g.price,onOpenChange:()=>C("price"),children:[e.jsxs(le,{className:"flex w-full items-center justify-between py-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Price Range"}),e.jsx(de,{className:`h-4 w-4 transition-transform ${g.price?"rotate-180":""}`})]}),e.jsx(ue,{className:"space-y-4 pt-2",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{htmlFor:"min-price",className:"text-xs text-muted-foreground",children:"Min"}),e.jsx(ie,{id:"min-price",type:"number",placeholder:"0",value:a.priceRange[0]||"",onChange:i=>{const x=Math.max(0,parseInt(i.target.value)||0),v=Math.max(x,a.priceRange[1]);s({...a,priceRange:[x,v]})},className:"h-8 text-sm"})]}),e.jsx("span",{className:"text-muted-foreground mt-4",children:"-"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{htmlFor:"max-price",className:"text-xs text-muted-foreground",children:"Max"}),e.jsx(ie,{id:"max-price",type:"number",placeholder:"10000",value:a.priceRange[1]||"",onChange:i=>{const x=Math.min(1e4,parseInt(i.target.value)||1e4),v=Math.min(x,a.priceRange[0]);s({...a,priceRange:[v,x]})},className:"h-8 text-sm"})]})]}),e.jsxs("div",{className:"px-2",children:[e.jsx(It,{value:a.priceRange,onValueChange:i=>s({...a,priceRange:i}),max:1e4,min:0,step:50,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground mt-2",children:[e.jsxs("span",{children:["₹",a.priceRange[0]]}),e.jsxs("span",{children:["₹",a.priceRange[1]]})]})]})]})})]}),e.jsxs(ce,{open:g.brands,onOpenChange:()=>C("brands"),children:[e.jsxs(le,{className:"flex w-full items-center justify-between py-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Tags"}),e.jsx(de,{className:`h-4 w-4 transition-transform ${g.brands?"rotate-180":""}`})]}),e.jsx(ue,{className:"space-y-3 pt-2",children:e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:d.map(i=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{id:`brand-${i}`,checked:a.brands.includes(i),onCheckedChange:x=>u(i,x),className:"h-4 w-4 md:h-5 md:w-5"}),e.jsx(H,{htmlFor:`brand-${i}`,className:"text-sm font-normal",children:i})]},i))})})]})]})]})}function Tt({filters:a,onRemoveFilter:s,onClearAll:o}){return a.categories.length>0||a.brands.length>0||a.availability.length>0||a.rating>0||a.discount>0||a.priceRange[0]>0||a.priceRange[1]<1e4||a.searchQuery.length>0?e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-4 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Active filters:"}),a.searchQuery&&e.jsxs(z,{variant:"secondary",className:"gap-1",children:['Search: "',a.searchQuery,'"',e.jsx(I,{variant:"ghost",size:"sm",className:"h-auto p-0 ml-1",onClick:()=>s("search",""),children:e.jsx(U,{className:"h-3 w-3"})})]}),a.categories.map(n=>e.jsxs(z,{variant:"secondary",className:"gap-1",children:[n,e.jsx(I,{variant:"ghost",size:"sm",className:"h-auto p-0 ml-1",onClick:()=>s("category",n),children:e.jsx(U,{className:"h-3 w-3"})})]},n)),a.brands.map(n=>e.jsxs(z,{variant:"secondary",className:"gap-1",children:[n,e.jsx(I,{variant:"ghost",size:"sm",className:"h-auto p-0 ml-1",onClick:()=>s("brand",n),children:e.jsx(U,{className:"h-3 w-3"})})]},n)),a.availability.map(n=>e.jsxs(z,{variant:"secondary",className:"gap-1",children:[n,e.jsx(I,{variant:"ghost",size:"sm",className:"h-auto p-0 ml-1",onClick:()=>s("availability",n),children:e.jsx(U,{className:"h-3 w-3"})})]},n)),a.rating>0&&e.jsxs(z,{variant:"secondary",className:"gap-1",children:[a.rating,"+ ⭐",e.jsx(I,{variant:"ghost",size:"sm",className:"h-auto p-0 ml-1",onClick:()=>s("rating",""),children:e.jsx(U,{className:"h-3 w-3"})})]}),a.discount>0&&e.jsxs(z,{variant:"secondary",className:"gap-1",children:[a.discount,"% off",e.jsx(I,{variant:"ghost",size:"sm",className:"h-auto p-0 ml-1",onClick:()=>s("discount",""),children:e.jsx(U,{className:"h-3 w-3"})})]}),(a.priceRange[0]>0||a.priceRange[1]<1e4)&&e.jsxs(z,{variant:"secondary",className:"gap-1",children:["₹",a.priceRange[0]," - ₹",a.priceRange[1],e.jsx(I,{variant:"ghost",size:"sm",className:"h-auto p-0 ml-1",onClick:()=>s("price",""),children:e.jsx(U,{className:"h-3 w-3"})})]}),e.jsx(I,{variant:"outline",size:"sm",onClick:o,className:"ml-2 bg-transparent",children:"Clear All"})]}):null}function _t(){var M;const[a,s]=Ge(),{categoryId:o}=Je(),[t,n]=f.useState({categories:[],brands:[],priceRange:[0,1e4],rating:0,discount:0,availability:[],searchQuery:""}),[m,d]=f.useState([]),[g,p]=f.useState(!0),[C,k]=f.useState(!1),{currentDepotId:u}=nt(),{addItem:y,validateCart:i,state:x}=ot(),{actions:v,state:b}=it(),{products:h,isLoading:_,error:E,refresh:P}=ht(u);f.useEffect(()=>{const c=a.get("tag"),r=o?parseInt(o,10):null;if(console.log("URL parameters:",{tagParam:c,categoryId:r}),h.length>0||m.length>0){let l={...t};if(r&&!isNaN(r)){const S=m.find(A=>A.id===r);S?(console.log("Setting category filter to:",S.name),l.categories=[S.name]):h.some($=>$.product.categoryId===r)&&(console.log("Setting category filter by ID:",r),l.categories=[r.toString()])}if(c){const S=new Set;h.forEach(R=>{R.product.tags&&R.product.tags.split(",").map(Y=>Y.trim()).forEach(Y=>S.add(Y))});const $=Array.from(S).find(R=>R.toLowerCase()===c.toLowerCase())||c;console.log("Setting brand filter to:",$,"(original:",c,")"),l.brands=[$]}else r||(l.brands=[],l.categories=[]);JSON.stringify(l)!==JSON.stringify(t)&&(console.log("New filters after URL params:",l),n(l))}},[a,o,h,m]),f.useEffect(()=>{(async()=>{try{p(!0);const r=await dt.getCategories();d(r)}catch(r){console.error("Failed to fetch categories:",r)}finally{p(!1)}})()},[]),f.useEffect(()=>{(async()=>{if(u&&(!b.currentDepot||b.currentDepot.id!==u))try{console.log(`CategoryProductsPage: Loading products for depot ${u}`);const r={id:u,name:`Depot ${u}`,address:"",pincode:"",city:"",isActive:!0,isOnline:!0};await v.setDepot(r),P&&await P(),await i(u)}catch(r){console.error("Failed to load products for depot:",r)}})()},[u,b.currentDepot,v,P,i]),f.useEffect(()=>{b.currentDepot&&(console.log(`CategoryProductsPage: Products loaded for depot: ${b.currentDepot.name} (${b.currentDepot.id})`),console.log(`CategoryProductsPage: Total products: ${h.length}`))},[b.currentDepot,h.length]);const O=f.useMemo(()=>{const c=new Set;h.forEach(l=>{var A;const D=l.product;D.tags&&D.tags.split(",").map(R=>R.trim()).filter(R=>R.length>0).forEach(R=>{c.add(R),R.toLowerCase().includes("fruit")&&console.log(`Found fruit-related tag: "${R}" in product: ${D.name}`)}),D.isDairyProduct?c.add("Contains Dairy"):c.add("Non-Dairy");const S=D.name.split(" ")[0];S&&S.length>2&&!S.toLowerCase().includes("fresh")&&c.add(S),(A=D.category)!=null&&A.name&&c.add(D.category.name)});const r=Array.from(c).sort();return console.log("Available brands/tags:",r),console.log("Fruits-related brands:",r.filter(l=>l.toLowerCase().includes("fruit"))),r},[h]),B=f.useMemo(()=>{console.log("Filtering products with filters:",t),console.log("Total products to filter:",h.length),t.brands.some(r=>r.toLowerCase()==="fruits")&&(console.log("=== DEBUG: Fruits filter active ==="),console.log("All products and their tags:"),h.forEach((r,l)=>{console.log(`${l+1}. ${r.product.name}: tags="${r.product.tags}"`)}),console.log("Current brand filters:",t.brands),console.log("About to start filtering..."));const c=h.map(r=>{var xe,be;const l=r.product;if(t.categories.length>0&&!t.categories.some(w=>{var F,L;if(((F=l.category)==null?void 0:F.name)===w)return!0;const N=parseInt(w,10);return!isNaN(N)&&l.categoryId===N||((L=l.category)==null?void 0:L.id)===N})||t.brands.length>0&&!t.brands.some(w=>{const N=w.toLowerCase();N==="fruits"&&(console.log(`
=== Checking product: ${l.name} ===`),console.log(`Brand filter: "${w}" (lowercase: "${N}")`));const F=l.name.toLowerCase().includes(N);if(N==="fruits"){const T=["orange","oranges","apple","apples","banana","bananas","mango","mangoes","grape","grapes","fruit"].some(W=>l.name.toLowerCase().includes(W));if(console.log(`Name match: ${F}`),console.log(`Is fruit product (by name): ${T}`),T)return console.log(`✓ Matched as fruit product: ${l.name}`),!0}else N==="fruits"&&console.log(`Name match: ${F}`);let L=!1;if(l.tags){const ne=l.tags.split(",").map(T=>T.trim().toLowerCase());(N==="fruits"||w.toLowerCase()==="fruits")&&(console.log(`Product: ${l.name}`),console.log(`Raw tags: "${l.tags}"`),console.log("Parsed tags:",ne),console.log(`Looking for brand: "${w}" (lowercase: "${N}")`)),L=ne.some(T=>{const W=T===N,ye=T.includes(N)||N.includes(T),ve=W||ye;return(N==="fruits"||w.toLowerCase()==="fruits")&&(console.log(`  Checking tag: "${T}" against "${N}"`),console.log(`    Exact match (${T} === ${N}): ${W}`),console.log(`    Contains match: ${ye}`),console.log(`    Final result: ${ve}`)),ve})}if(N==="dairy"||N==="contains-dairy")return l.isDairyProduct===!0||L||F;if(N==="non-dairy")return l.isDairyProduct===!1||L||F;const J=F||L;return N==="fruits"&&(console.log(`Tag match: ${L}`),console.log(`Final match for ${l.name}: nameMatch=${F}, tagMatch=${L}, finalMatch=${J}`),console.log(`=== End ${l.name} ===
`)),J}))return null;if(t.searchQuery){const j=t.searchQuery.toLowerCase(),w=l.name.toLowerCase().includes(j),N=(xe=l.description)==null?void 0:xe.toLowerCase().includes(j),F=(be=l.tags)==null?void 0:be.toLowerCase().includes(j);if(!w&&!N&&!F)return null}if(t.rating>0&&4<t.rating||t.discount>0&&(r.discount?r.discount*100:0)<t.discount)return null;let S=r.variants;if((t.priceRange[0]>0||t.priceRange[1]<1e4)&&(S=r.variants.filter(j=>{const w=j.buyOncePrice||j.mrp||0;return w>=t.priceRange[0]&&w<=t.priceRange[1]}),S.length===0))return null;if(t.availability.length>0){const j=S.some(J=>!J.notInStock&&J.closingQty>0),w=t.availability.includes("In Stock")&&j,N=t.availability.includes("Same Day Delivery")&&j,F=t.availability.includes("Express Delivery")&&j,L=t.availability.includes("Bulk Available");if(!w&&!N&&!F&&!L)return null}const A=S.filter(j=>!j.notInStock&&!j.isHidden),$=A.map(j=>{const w=j.buyOncePrice||j.mrp||0;return typeof w=="number"&&isFinite(w)&&w>0?w:0}).filter(j=>j>0),R=$.length>0?Math.min(...$):0,se=A.length>0,Y=A.map(j=>{const w=j.mrp||0;return typeof w=="number"&&isFinite(w)&&w>0?w:0}).filter(j=>j>0),Z=Y.length>0?Math.max(...Y):0;let re=0;return R&&R<Z&&(re=(Z-R)/Z),{...r,variants:S,buyOncePrice:R,mrp:Z,discount:re>0?re:0,inStock:se,deliveryTime:se?"Same day delivery":"Out of stock"}}).filter(r=>r!==null);return console.log(`Filtered ${c.length} products out of ${h.length}`),(t.brands.includes("Fruits")||t.brands.includes("fruits"))&&console.log("Products with Fruits filter:",c.map(r=>({name:r==null?void 0:r.product.name,tags:r==null?void 0:r.product.tags}))),c},[h,t]),V=c=>{const r=new URLSearchParams(a);c.brands.length>0?r.set("tag",c.brands[0]):r.delete("tag"),s(r)},ae=(c,r)=>{let l;switch(c){case"category":l={...t,categories:t.categories.filter(D=>D!==r)};break;case"brand":l={...t,brands:t.brands.filter(D=>D!==r)};break;case"availability":l={...t,availability:t.availability.filter(D=>D!==r)};break;case"rating":l={...t,rating:0};break;case"discount":l={...t,discount:0};break;case"price":l={...t,priceRange:[0,1e4]};break;case"search":l={...t,searchQuery:""};break;default:return}n(l),V(l)},K=()=>{const c={categories:[],brands:[],priceRange:[0,1e4],rating:0,discount:0,availability:[],searchQuery:""};n(c),V(c)},Q=(c,r,l)=>{if(!r){console.error("Cannot add to cart: no variant provided");return}console.log("Adding to cart:",{product:c.product.name,variant:r.name,quantity:l||1,price:r.buyOncePrice||c.buyOncePrice}),y(c,r,l||1)};return _||g?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading products..."})]})}):E?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Failed to load products"}),e.jsx(I,{onClick:()=>window.location.reload(),children:"Retry"})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{children:e.jsx(ct,{cartCount:x.items.reduce((c,r)=>c+r.quantity,0),onSearch:c=>n(r=>({...r,searchQuery:c}))})}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"hidden lg:block lg:w-80 flex-shrink-0",children:e.jsx(Ne,{filters:t,onFiltersChange:c=>{n(c),V(c)},onClearAll:K,categories:m,brands:O})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"lg:hidden mb-4",children:e.jsxs(Ze,{open:C,onOpenChange:k,children:[e.jsx(We,{asChild:!0,children:e.jsxs(I,{variant:"outline",className:"w-full flex items-center justify-center gap-2 h-12 border-2 hover:bg-accent/50 hover:border-primary/30 transition-all duration-200",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Filters"}),(t.brands.length>0||t.categories.length>0||t.availability.length>0||t.rating>0||t.discount>0||t.searchQuery)&&e.jsx("span",{className:"ml-1 bg-primary text-primary-foreground text-xs px-2 py-0.5 rounded-full",children:[...t.brands,...t.categories,...t.availability,...t.rating>0?["Rating"]:[],...t.discount>0?["Discount"]:[],...t.searchQuery?["Search"]:[]].length})]})}),e.jsxs(et,{className:"max-h-[90vh] flex flex-col",children:[e.jsx(tt,{className:"text-left border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(me,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(at,{className:"text-lg font-semibold",children:"Filter Products"}),e.jsxs(st,{className:"text-sm text-muted-foreground",children:[B.length," of ",h.length," products"]})]})]}),(t.brands.length>0||t.categories.length>0||t.availability.length>0||t.rating>0||t.discount>0||t.searchQuery)&&e.jsxs(z,{variant:"secondary",className:"text-xs",children:[[...t.brands,...t.categories,...t.availability,...t.rating>0?["Rating"]:[],...t.discount>0?["Discount"]:[],...t.searchQuery?["Search"]:[]].length," active"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-4 space-y-6",children:e.jsx(Ne,{filters:t,onFiltersChange:c=>{n(c),V(c)},onClearAll:K,categories:m,brands:O})})}),e.jsx(rt,{className:"border-t bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 p-4",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[(t.brands.length>0||t.categories.length>0||t.availability.length>0||t.rating>0||t.discount>0||t.searchQuery)&&e.jsx(I,{variant:"ghost",size:"sm",onClick:K,className:"self-start text-muted-foreground hover:text-foreground",children:"Clear all filters"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(we,{asChild:!0,children:e.jsx(I,{variant:"outline",className:"flex-1",size:"lg",children:"Cancel"})}),e.jsx(we,{asChild:!0,children:e.jsxs(I,{className:"flex-1",size:"lg",onClick:()=>k(!1),children:["Show ",B.length," Products"]})})]})]})})]})]})}),e.jsx(Tt,{filters:t,onRemoveFilter:ae,onClearAll:K}),e.jsx("div",{className:"flex items-center justify-between mb-6 mt-4",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Products (",B.length,")"]}),o&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Category: ",e.jsx("span",{className:"font-medium",children:((M=m.find(c=>c.id===parseInt(o,10)))==null?void 0:M.name)||`Category ${o}`})]}),a.get("tag")&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Filtered by tag: ",e.jsx("span",{className:"font-medium",children:a.get("tag")})]})]})}),e.jsx(gt,{products:B,onAddToCart:Q,isLoading:_}),B.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:"No products found matching your filters."}),e.jsx(I,{variant:"outline",onClick:K,className:"mt-4 bg-transparent",children:"Clear All Filters"})]})]})]})}),e.jsx(lt,{})]})}const Qt=()=>e.jsx(ut,{children:e.jsx(mt,{children:e.jsx(_t,{})})});export{Qt as default};
