import{R as S,j as e,r as c,c as T,b as H,B as U,I as M}from"./index-CjAs9_jf.js";import{a as R,b as B,u as V,H as q,p as D,F as _}from"./Footer-DwSgdFzh.js";import{P as G}from"./ProductGrid-CYFRGzUV.js";import"./ProductCard-Bk96mEqx.js";const W=()=>{const p=[{title:"Fresh groceries, delivered to your door",description:"Handpicked fruits, crisp vegetables, dairy, and daily essentials. Fast delivery, great prices, and quality you can trust.",primaryLabel:"Shop now",primaryHref:"#products",secondaryLabel:"View deals",secondaryHref:"#deals",image:"https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1200&auto=format&fit=crop",alt:"Fresh produce assortment including fruits and vegetables",badge:"Up to 30% off today"},{title:"Daily essentials, right when you need them",description:"Milk, bread, eggs, snacks, and more — delivered fast with freshness guaranteed.",primaryLabel:"Browse essentials",primaryHref:"#essentials",secondaryLabel:"Today’s offers",secondaryHref:"#offers",image:"https://images.unsplash.com/photo-1506806732259-39c2d0268443?q=80&w=1200&auto=format&fit=crop",alt:"Assorted vegetables and herbs on a table",badge:"Fresh arrivals daily",imageOnly:!0},{title:"Quality you can trust",description:"Locally sourced produce and top brands — curated for your kitchen.",primaryLabel:"Explore categories",primaryHref:"#categories",secondaryLabel:"Best sellers",secondaryHref:"#bestsellers",image:"https://images.unsplash.com/photo-1511690656952-34342bb7c2f2?q=80&w=1200&auto=format&fit=crop",alt:"Grocery basket with assorted products",badge:"Top picks this week",imageOnly:!0}],[g,h]=S.useState(0),y=S.useRef(null),b=()=>{typeof window<"u"&&y.current!==null&&(window.clearInterval(y.current),y.current=null)},x=()=>{typeof window>"u"||(b(),y.current=window.setInterval(()=>{h(i=>(i+1)%p.length)},5e3))};S.useEffect(()=>(x(),b),[]);const w=()=>h(i=>(i-1+p.length)%p.length),v=()=>h(i=>(i+1)%p.length);return e.jsx("section",{className:"relative bg-gradient-to-br from-green-600 via-green-500 to-emerald-500 text-white",children:e.jsx("div",{className:"w-screen relative left-1/2 right-1/2 -ml-[50vw] -mr-[50vw] p-0",children:e.jsxs("div",{className:"relative overflow-hidden h-[22rem] sm:h-[26rem] md:h-[30rem] lg:h-[36rem] group",onMouseEnter:b,onMouseLeave:x,role:"region","aria-roledescription":"carousel","aria-label":"Hero promotions",children:[p.map((i,d)=>e.jsx("div",{className:`absolute inset-0 transition-all duration-700 ease-in-out transform ${d===g?"opacity-100 translate-x-0":"opacity-0 translate-x-6 pointer-events-none"}`,"aria-hidden":d!==g,children:i.imageOnly?e.jsx("img",{className:"w-full h-full object-cover",src:i.image,alt:i.alt,loading:d===g?"eager":"lazy",decoding:"async"}):e.jsxs("div",{className:"p-4 grid md:grid-cols-2 gap-8 items-center h-full",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-extrabold tracking-tight leading-tight",children:i.title}),e.jsx("p",{className:"mt-4 text-white/90 text-base md:text-lg",children:i.description}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx("a",{href:i.primaryHref,className:"inline-flex items-center justify-center rounded-md bg-white text-green-700 font-medium h-10 px-6 shadow hover:shadow-md transition","aria-label":i.primaryLabel,children:i.primaryLabel}),e.jsx("a",{href:i.secondaryHref,className:"inline-flex items-center justify-center rounded-md border border-white/80 text-white font-medium h-10 px-6 hover:bg-white/10 transition","aria-label":i.secondaryLabel,children:i.secondaryLabel})]})]}),e.jsxs("div",{className:"relative h-full",children:[e.jsx("img",{className:"w-full h-full max-w-2xl max-h-2xl object-cover rounded-lg shadow-lg",src:i.image,alt:i.alt,loading:d===g?"eager":"lazy",decoding:"async"}),e.jsx("div",{className:"absolute -bottom-4 -right-4 bg-white/90 text-green-700 px-4 py-2 rounded shadow md:text-lg font-semibold",children:i.badge})]})]})},i.title)),e.jsx("button",{type:"button","aria-label":"Previous slide",onClick:w,className:"hidden sm:flex absolute inset-y-0 left-2 z-10 items-center justify-center w-10 text-white/90 hover:text-white transition-opacity opacity-0 group-hover:opacity-100 focus:opacity-100",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M15 6l-6 6 6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("button",{type:"button","aria-label":"Next slide",onClick:v,className:"hidden sm:flex absolute inset-y-0 right-2 z-10 items-center justify-center w-10 text-white/90 hover:text-white transition-opacity opacity-0 group-hover:opacity-100 focus:opacity-100",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex items-center gap-2 z-10",children:p.map((i,d)=>e.jsx("button",{type:"button","aria-label":`Go to slide ${d+1}`,onClick:()=>h(d),"aria-current":d===g,className:`h-2.5 w-2.5 rounded-full transition-all ${d===g?"bg-white":"bg-white/50 hover:bg-white/70"}`},d))})]})})})},Q=()=>{const[p,g]=c.useState(""),[h,y]=c.useState([]),[b]=c.useState("relevance"),[x,w]=c.useState(null),v=T();H();const[i,d]=c.useState([]),[P,N]=c.useState(!1),[F,C]=c.useState(null),{state:n,actions:$}=R(),{addItem:O,state:E}=B(),{currentDepotId:j}=V();console.log("=== PRODUCT TRANSFORMATION DEBUG ==="),console.log("pricingState.products:",n.products),console.log("pricingState.depotVariants:",n.depotVariants);const L=n.products.map(t=>{const s=n.depotVariants.filter(m=>m.productId===t.id);console.log(`Product ${t.id} (${t.name}) has ${s.length} variants:`,s);const a=s.filter(m=>!m.notInStock&&!m.isHidden),r=a.map(m=>{const f=m.buyOncePrice||m.mrp||0;return typeof f=="number"&&isFinite(f)&&f>0?f:0}).filter(m=>m>0),o=r.length>0?Math.min(...r):0,l=a.length>0,u=a.map(m=>{const f=m.mrp||0;return typeof f=="number"&&isFinite(f)&&f>0?f:0}).filter(m=>m>0),k=u.length>0?Math.max(...u):0;return{product:t,variants:s,buyOncePrice:o,mrp:k,inStock:l,deliveryTime:"Same day delivery"}}),I=n.isLoading;c.useEffect(()=>{(async()=>{N(!0),C(null);try{const s=await D.getCategories();console.log("Fetched categories:",s);const r=[...(Array.isArray(s)?s:[]).map(o=>({id:String(o.id??o._id??o.slug??""),name:o.name||o.title||"Category",imageUrl:o.imageUrl||o.attachmentUrl||o.iconUrl||o.url||void 0}))].sort((o,l)=>{const u=typeof o.name=="string"&&o.name.toLowerCase().includes("milk")?1:0,k=typeof l.name=="string"&&l.name.toLowerCase().includes("milk")?1:0;return u!==k?k-u:(o.name||"").localeCompare(l.name||"")});d(r)}catch(s){C((s==null?void 0:s.message)||"Failed to load categories")}finally{N(!1)}})()},[]),c.useEffect(()=>{(async()=>{if(j&&(!n.currentDepot||n.currentDepot.id!==j))try{const s={id:j,name:`Depot ${j}`,address:"",pincode:"",isActive:!0};await $.setDepot(s)}catch(s){console.error("Failed to load products for depot:",s)}})()},[j,n.currentDepot,$]),c.useEffect(()=>{!n.userLocation&&n.isLoading},[n.userLocation,n.isLoading]),c.useEffect(()=>{n.currentDepot&&(console.log(`Products loaded for depot: ${n.currentDepot.name} (${n.currentDepot.id})`),console.log(`Total products: ${n.products.length}, Total variants: ${n.depotVariants.length}`),console.log("Raw products from API:",n.products),console.log("Raw depot variants from API:",n.depotVariants))},[n.currentDepot,n.products.length,n.depotVariants.length]),c.useEffect(()=>{const t=(v.hash||"").replace("#","");if(!t)return;if(t.startsWith("category-")){const r=t.slice(9),o=parseInt(r,10);Number.isFinite(o)&&y([o])}const s=()=>{const r=document.getElementById(t);r&&r.scrollIntoView({behavior:"smooth",block:"start"})};s();const a=setTimeout(s,150);return()=>clearTimeout(a)},[v.hash,P,i.length]),c.useEffect(()=>{const s=new URLSearchParams(v.search||"").get("tag");if(!s){w(null);return}const a=s.toLowerCase().trim();if(a.startsWith("category:")){const l=a.split(":")[1],u=parseInt(l||"",10);Number.isFinite(u)&&y([u]),w(null)}else w(a);const r=()=>{const l=document.getElementById("products");l&&l.scrollIntoView({behavior:"smooth",block:"start"})};r();const o=setTimeout(r,120);return()=>clearTimeout(o)},[v.search]);const z=c.useMemo(()=>{let t=L;if(console.log(`Filter display ${t.length} products with query "${p}"`),p.trim()){const a=p.trim().toLowerCase();t=t.filter(r=>r.product.name.toLowerCase().includes(a)||(r.product.description?r.product.description.toLowerCase().includes(a):!1))}if(h.length>0&&(t=t.filter(a=>h.includes(a.product.categoryId||0))),x)if(x==="non-dairy")t=t.filter(a=>!a.product.isDairyProduct);else if(x==="contains-dairy")t=t.filter(a=>!!a.product.isDairyProduct);else{const a=x.toLowerCase().trim();t=t.filter(r=>{const o=r.product.tags;if(!o)return!1;const l=o.split(",").map(u=>u.trim().toLowerCase()).filter(Boolean);return a==="pasteurized"||a==="pasturized"?l.includes("pasteurized")||l.includes("pasturized"):l.includes(a)})}const s=[...t];switch(b){case"price_asc":s.sort((a,r)=>a.buyOncePrice-r.buyOncePrice);break;case"price_desc":s.sort((a,r)=>r.buyOncePrice-a.buyOncePrice);break;case"popularity_desc":s.sort((a,r)=>(r.product.id||0)-(a.product.id||0));break;case"relevance":default:s.sort((a,r)=>a.buyOncePrice!==r.buyOncePrice?a.buyOncePrice-r.buyOncePrice:(a.product.id||0)-(r.product.id||0));break}return console.log(`Filtered ${t.length} products, sorted by ${b}`),console.log(`Final product count: ${s.length}`),s},[L,p,h,b,x]),A=(t,s,a)=>{s&&O(t,s,a||1)};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(q,{cartCount:E.items.reduce((t,s)=>t+s.quantity,0),onSearch:g}),e.jsxs("main",{className:"flex-1",children:[e.jsx(W,{}),e.jsxs("section",{className:"container mx-auto px-4 md:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold",children:"Browse by Category"}),F&&e.jsx(U,{size:"sm",variant:"outline",onClick:()=>{N(!0),D.getCategories().then(t=>{const a=[...(Array.isArray(t)?t:[]).map(r=>({id:String(r.id??r._id??r.slug??""),name:r.name||r.title||"Category",imageUrl:r.imageUrl||r.attachmentUrl||r.iconUrl||r.url||void 0}))].sort((r,o)=>{const l=typeof r.name=="string"&&r.name.toLowerCase().includes("milk")?1:0,u=typeof o.name=="string"&&o.name.toLowerCase().includes("milk")?1:0;return l!==u?u-l:(r.name||"").localeCompare(o.name||"")});d(a),C(null)}).catch(t=>C((t==null?void 0:t.message)||"Failed to load categories")).finally(()=>N(!1))},children:"Retry"})]}),P?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4",children:Array.from({length:12}).map((t,s)=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"aspect-square w-full rounded-lg bg-muted/30"}),e.jsx("div",{className:"h-3 w-2/3 bg-muted/40 rounded mt-3"})]},s))}):e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-7 gap-4",children:[i.map(t=>{var r;const s=parseInt(t.id,10),a=h.includes(s);return e.jsxs("a",{id:`category-${s}`,href:`/snf/category/${s}`,className:"group text-left max-w-[10rem]","aria-label":`Filter by category ${t.name}`,children:[e.jsx("div",{className:`relative aspect-square w-full overflow-hidden rounded-full  border bg-accent/10 ${a?"ring-2 ring-primary border-primary":""}`,children:t.imageUrl?e.jsx("img",{src:`https://snf.3.7.237.251.sslip.io${t.imageUrl}`,alt:t.name,className:" h-full w-full  object-cover rounded-full transition-transform duration-300 group-hover:scale-[1.03]",loading:"lazy"}):e.jsx("div",{className:"h-full w-full grid place-items-center text-muted-foreground bg-gradient-to-br from-muted/30 to-transparent rounded-full",children:((r=t.name)==null?void 0:r.charAt(0))||"C"})}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx("p",{className:`text-sm font-medium line-clamp-2 transition-colors ${a?"text-primary":"group-hover:text-primary"}`,children:t.name})})]},t.id)}),i.length===0&&!F&&e.jsx("p",{className:"col-span-2 sm:col-span-3 lg:col-span-6 text-muted-foreground",children:"No categories available."})]})]}),e.jsxs("section",{className:"container mx-auto px-4 md:px-6 lg:px-8",children:[e.jsx("div",{className:"h-px w-full bg-border/60"}),e.jsx("div",{className:"flex items-end justify-between py-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold",children:"Products"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click a category above to filter products below"})]})})]}),e.jsxs("section",{id:"products",className:"container mx-auto px-3 sm:px-4 md:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(M,{value:p,onChange:t=>g(t.target.value),placeholder:"Search products","aria-label":"Search products"})}),I&&L.length===0?e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:Array.from({length:8}).map((t,s)=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"aspect-[4/3] w-full rounded-lg bg-muted/30"}),e.jsx("div",{className:"h-3 w-3/4 bg-muted/40 rounded mt-3"})]},s))})}):e.jsx("div",{className:"",children:e.jsx(G,{products:z,onAddToCart:A,isLoading:I})})]})]}),e.jsx(_,{})]})},Z=()=>e.jsx(Q,{});export{Z as default};
