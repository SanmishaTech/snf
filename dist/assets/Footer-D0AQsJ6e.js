var fe=Object.defineProperty;var xe=(c,a,e)=>a in c?fe(c,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[a]=e;var S=(c,a,e)=>xe(c,typeof a!="symbol"?a+"":a,e);import{aj as ve,r as d,p as B,j as t,b as Ne,ai as se,a7 as Ee,L as G,ak as be,a3 as we,a4 as Ie,al as je,a9 as Se,D as K,T as Pe,z as Oe,P as _e,B as M,am as V,an as Y,M as W,ao as H,ap as J,I as De,E as Q,C as Ae,aq as X,ar as Z,as as Ce,at as Te}from"./index-BtRkqcd7.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Le=ve("locate-fixed",ke);class Re{constructor(){S(this,"DEFAULT_OPTIONS",{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5});S(this,"GEOCODING_API_URL","https://api.opencagedata.com/geocode/v1/json");S(this,"GEOCODING_API_KEY","");S(this,"KNOWN_AREA_PINCODES",{"19.0_72.8":"400001","19.1_72.8":"400050","19.2_72.9":"400099","19.3_72.8":"421202","19.4_73.0":"421301","19.2_73.0":"421202","19.23_73.0":"421202","19.21_73.02":"421202"})}isGeolocationSupported(){return"geolocation"in navigator&&typeof navigator.geolocation=="object"}async checkPermissionStatus(){if(!this.isGeolocationSupported())return"denied";try{return"permissions"in navigator?(await navigator.permissions.query({name:"geolocation"})).state:await this.checkPermissionByPosition()}catch(a){return console.warn("Error checking geolocation permission:",a),"prompt"}}async requestPermission(){if(!this.isGeolocationSupported())throw{type:"PERMISSION_DENIED",message:"Geolocation is not supported in your browser",code:"GEOLOCATION_NOT_SUPPORTED"};try{return"permissions"in navigator?(await navigator.permissions.query({name:"geolocation"})).state:(await this.getCurrentPosition(),"granted")}catch(a){return a.code===1?"denied":"prompt"}}async requestLocationWithExplanation(a){if(!this.isGeolocationSupported())throw{type:"PERMISSION_DENIED",message:"Geolocation is not supported in your browser. Please enter your pincode manually.",code:1,recoverable:!0};try{const e=await this.getCurrentPosition(a);return await this.reverseGeocode(e.coords.latitude,e.coords.longitude)}catch(e){const s=e;switch(s.code){case 1:throw{type:"PERMISSION_DENIED",message:"Location access was denied. Please enable location access or enter your pincode manually.",code:"PERMISSION_DENIED",details:s};case 2:throw{type:"POSITION_UNAVAILABLE",message:"Unable to retrieve your location. Please check your device settings or enter your pincode manually.",code:"POSITION_UNAVAILABLE",details:s};case 3:throw{type:"TIMEOUT",message:"Location request timed out. Please try again or enter your pincode manually.",code:"TIMEOUT",details:s};default:throw{type:"TIMEOUT",message:"An unknown error occurred while getting your location. Please try again or enter your pincode manually.",code:3,recoverable:!0,details:s}}}}getCurrentPosition(a){return new Promise((e,s)=>{navigator.geolocation.getCurrentPosition(e,i=>s(i),{...this.DEFAULT_OPTIONS,...a})})}async checkPermissionByPosition(){try{return await this.getCurrentPosition({timeout:2e3}),"granted"}catch(a){return a.code===1?"denied":"prompt"}}async reverseGeocode(a,e){try{if(!this.GEOCODING_API_KEY){console.warn("GEOCODING_API_KEY not configured. Using fallback pincode mapping.");const n=this.generateMockPincode(a,e);let m="Unknown",x="Maharashtra",p="Unknown Address";return n==="421202"||n==="421201"||n==="421203"?(m="Dombivli",p="Dombivli, Thane"):n==="421301"?(m="Kalyan",p="Kalyan, Thane"):n.startsWith("400")&&(m="Mumbai",p="Mumbai"),{latitude:a,longitude:e,pincode:n,city:m,state:x,country:"India",address:p}}const s=new URL(this.GEOCODING_API_URL);s.searchParams.append("q",`${a}+${e}`),s.searchParams.append("key",this.GEOCODING_API_KEY),s.searchParams.append("limit","1");const i=await fetch(s.toString());if(!i.ok)throw new Error(`Geocoding API request failed: ${i.status}`);const l=await i.json();if(l.results.length===0)throw new Error("No results found for the given coordinates");const u=l.results[0],r=u.components;return{latitude:a,longitude:e,pincode:r.postcode||this.generateMockPincode(a,e),city:r.city||r.town||r.village||"Unknown",state:r.state||"Unknown",country:r.country||"India",address:u.formatted||"Unknown Address"}}catch(s){return console.warn("Reverse geocoding failed, using fallback:",s),{latitude:a,longitude:e,pincode:this.generateMockPincode(a,e),city:"Unknown",state:"Unknown",country:"India",address:"Unknown Address"}}}generateMockPincode(a,e){const s=`${a.toFixed(1)}_${e.toFixed(1)}`;if(this.KNOWN_AREA_PINCODES[s])return console.log(`Using known area pincode for ${s}: ${this.KNOWN_AREA_PINCODES[s]}`),this.KNOWN_AREA_PINCODES[s];if(a>=19.15&&a<=19.35&&e>=72.85&&e<=73.15)return console.log("Detected Dombivli/Kalyan area, returning 421202"),"421202";if(a>=18.9&&a<=19.5&&e>=72.7&&e<=73.2)return console.log("Detected Mumbai metropolitan region, returning default Mumbai pincode"),"400001";console.warn("No known area match found for coordinates, generating mock pincode");const i=Math.abs(a).toString().replace(".",""),l=Math.abs(e).toString().replace(".","");let r=(i+l).substring(0,6);for(;r.length<6;)r+="0";return r}async getPositionFromPincode(a){if(!a||!/^\d{6}$/.test(a))throw{type:"INVALID_PINCODE",message:"Please enter a valid 6-digit pincode",code:"INVALID_PINCODE"};try{if(!this.GEOCODING_API_KEY){console.warn("GEOCODING_API_KEY not configured. Using fallback for known pincodes.");const n={421202:{latitude:19.217,longitude:73.025,pincode:"421202",city:"Dombivli",state:"Maharashtra",country:"India",address:"Dombivli East, Thane"},421201:{latitude:19.218,longitude:73.023,pincode:"421201",city:"Dombivli",state:"Maharashtra",country:"India",address:"Dombivli West, Thane"},421301:{latitude:19.243,longitude:73.129,pincode:"421301",city:"Kalyan",state:"Maharashtra",country:"India",address:"Kalyan, Thane"},400001:{latitude:18.9388,longitude:72.8354,pincode:"400001",city:"Mumbai",state:"Maharashtra",country:"India",address:"Mumbai GPO"}};return n[a]?(console.log(`Using known mapping for pincode ${a}`),n[a]):{latitude:this.generateMockLatitude(a),longitude:this.generateMockLongitude(a),pincode:a,city:"Unknown",state:"Maharashtra",country:"India",address:`Pincode ${a}`}}const e=new URL(this.GEOCODING_API_URL);e.searchParams.append("q",a),e.searchParams.append("countrycode","in"),e.searchParams.append("key",this.GEOCODING_API_KEY),e.searchParams.append("limit","1");const s=await fetch(e.toString());if(!s.ok)throw new Error(`Geocoding API request failed: ${s.status}`);const i=await s.json();if(i.results.length===0)throw{type:"INVALID_PINCODE",message:"No location found for the given pincode. Please check and try again.",code:"PINCODE_NOT_FOUND"};const l=i.results[0],u=l.geometry,r=l.components;return{latitude:u.lat,longitude:u.lng,pincode:a,city:r.city||r.town||r.village||"Unknown",state:r.state||"Unknown",country:r.country||"India",address:l.formatted||`Pincode ${a}`}}catch(e){if(e.type==="INVALID_PINCODE")throw e;return console.warn("Forward geocoding failed, using fallback:",e),{latitude:this.generateMockLatitude(a),longitude:this.generateMockLongitude(a),pincode:a,city:"Unknown",state:"Unknown",country:"India",address:`Pincode ${a}`}}}generateMockLatitude(a){return 8+parseInt(a.substring(0,3))/1e3*10}generateMockLongitude(a){return 68+parseInt(a.substring(3,6))/1e3*20}watchPosition(a,e,s){if(!this.isGeolocationSupported())return e&&e({type:"PERMISSION_DENIED",message:"Geolocation is not supported in your browser",code:1,recoverable:!0}),()=>{};const i=navigator.geolocation.watchPosition(async l=>{try{const u=await this.reverseGeocode(l.coords.latitude,l.coords.longitude);a(u)}catch(u){e&&e(u)}},l=>{if(e){const u={type:"TIMEOUT",message:l.message,code:l.code,recoverable:!0,details:l};e(u)}},{...this.DEFAULT_OPTIONS,...s});return()=>{navigator.geolocation.clearWatch(i)}}calculateDistance(a,e,s,i){const u=this.toRadians(s-a),r=this.toRadians(i-e),n=Math.sin(u/2)*Math.sin(u/2)+Math.cos(this.toRadians(a))*Math.cos(this.toRadians(s))*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))}toRadians(a){return a*(Math.PI/180)}}const R=new Re;class Me{constructor(){S(this,"API_BASE_URL","/api");S(this,"CACHE_TTL",30*60*1e3)}async getDepotByPincode(a){try{const e=await fetch(`${this.API_BASE_URL}/public/area-masters/by-pincode/${a}`);if(!e.ok){if(e.status===404)return null;throw new Error(`API request failed: ${e.status}`)}const s=await e.json();return!s.success||!s.data||s.data.length===0?null:s.data[0].depot||null}catch(e){throw console.error("Error fetching depot by pincode:",e),e}}async getAllDepotsForPincode(a){try{const e=await fetch(`${this.API_BASE_URL}/public/area-masters/by-pincode/${a}`);if(!e.ok){if(e.status===404)return[];throw new Error(`API request failed: ${e.status}`)}const s=await e.json();return!s.success||!s.data?[]:s.data.filter(l=>l.depot).map(l=>l.depot).filter((l,u,r)=>r.findIndex(n=>n.id===l.id)===u)}catch(e){throw console.error("Error fetching all depots for pincode:",e),e}}async validateServiceAvailability(a){try{const e=await fetch(`${this.API_BASE_URL}/public/area-masters/by-pincode/${a}`);if(!e.ok){if(e.status===404)return{isAvailable:!1,supportedProducts:[]};throw new Error(`API request failed: ${e.status}`)}const s=await e.json();if(!s.success||!s.data||s.data.length===0)return{isAvailable:!1};const l=s.data.filter(u=>u.depot).map(u=>u.depot).filter((u,r,n)=>n.findIndex(m=>m.id===u.id)===r);return{isAvailable:l.length>0,depot:l.length>0?l[0]:void 0,estimatedDeliveryTime:l.length>0?"Same day delivery":void 0,deliveryCharges:l.length>0?0:void 0,minimumOrderAmount:l.length>0?100:void 0,message:l.length>0?"Service available in your area":"Service not available in your area"}}catch(e){return console.error("Error validating service availability:",e),{isAvailable:!1,message:"Error checking service availability"}}}async getOnlineDepot(){try{const a=await fetch(`${this.API_BASE_URL}/public/depots/online`);if(!a.ok)throw new Error(`API request failed: ${a.status}`);const e=await a.json();return!e.success||!e.data||e.data.length===0?null:e.data[0]}catch(a){return console.error("Error fetching online depot:",a),null}}async getOptimalDepot(a){if(a)try{const e=await this.getDepotByPincode(a);if(e)return e}catch(e){console.warn("Failed to get depot for pincode, falling back to online depot:",e)}try{const e=await this.getOnlineDepot();if(e)return e}catch(e){console.error("Failed to get online depot:",e)}return null}async doesDepotServePincode(a,e){try{const s=await fetch(`${this.API_BASE_URL}/public/area-masters/by-pincode/${e}`);if(!s.ok)return!1;const i=await s.json();return!i.success||!i.data?!1:i.data.some(l=>l.depotId===a)}catch(s){return console.error("Error checking if depot serves pincode:",s),!1}}async getAllDepots(){try{const a=await fetch(`${this.API_BASE_URL}/public/depots`);if(!a.ok)throw new Error(`API request failed: ${a.status}`);const e=await a.json();return!e.success||!e.data?[]:e.data}catch(a){return console.error("Error fetching all depots:",a),[]}}async getDepotById(a){try{const e=await fetch(`${this.API_BASE_URL}/public/depots/${a}`);if(!e.ok){if(e.status===404)return null;throw new Error(`API request failed: ${e.status}`)}const s=await e.json();return!s.success||!s.data?null:s.data}catch(e){return console.error("Error fetching depot by ID:",e),null}}async getDepotsByLocation(a,e){try{const s=await fetch(`${this.API_BASE_URL}/public/depots/nearby?lat=${a}&lng=${e}`);if(!s.ok)throw new Error(`API request failed: ${s.status}`);const i=await s.json();return!i.success||!i.data?[]:i.data}catch(s){return console.error("Error fetching depots by location:",s),[]}}getCacheKey(a){return`depot_mapping_${a}`}getCachedDepot(a){try{const e=this.getCacheKey(a),s=localStorage.getItem(e);if(!s)return null;const{depot:i,timestamp:l}=JSON.parse(s);return Date.now()-l>this.CACHE_TTL?(localStorage.removeItem(e),null):i}catch(e){return console.warn("Error reading cached depot:",e),null}}cacheDepot(a,e){try{const s=this.getCacheKey(a),i={depot:e,timestamp:Date.now()};localStorage.setItem(s,JSON.stringify(i))}catch(s){console.warn("Error caching depot:",s)}}clearCachedDepot(a){try{const e=this.getCacheKey(a);localStorage.removeItem(e)}catch(e){console.warn("Error clearing cached depot:",e)}}}const _=new Me,re={currentDepot:null,userLocation:null,products:[],depotVariants:[],isLoading:!1,error:null,isLocationPermissionGranted:!1,serviceAvailability:null};function Ue(c,a){switch(a.type){case"SET_DEPOT":return{...c,currentDepot:a.payload,error:null};case"SET_LOCATION":return{...c,userLocation:a.payload,error:null};case"SET_PRODUCTS":return{...c,products:a.payload,isLoading:!1};case"SET_DEPOT_VARIANTS":return{...c,depotVariants:a.payload,isLoading:!1};case"SET_LOADING":return{...c,isLoading:a.payload};case"SET_ERROR":return{...c,error:a.payload,isLoading:!1};case"SET_LOCATION_PERMISSION":return{...c,isLocationPermissionGranted:a.payload};case"SET_SERVICE_AVAILABILITY":return{...c,serviceAvailability:a.payload};case"UPDATE_PRODUCT_VARIANTS":return{...c,depotVariants:c.depotVariants.map(e=>e.product.id===a.payload.productId&&a.payload.variants.find(s=>s.id===e.id)||e)};case"RESET_STATE":return re;default:return c}}const ne=d.createContext(void 0),Ye=({children:c})=>{const[a,e]=d.useReducer(Ue,re);d.useEffect(()=>{s()},[]);const s=d.useCallback(async()=>{try{e({type:"SET_LOADING",payload:!0});const r=await R.checkPermissionStatus();if(e({type:"SET_LOCATION_PERMISSION",payload:r==="granted"}),r==="granted"){const n=await R.requestLocationWithExplanation();e({type:"SET_LOCATION",payload:n});const m=await _.getOptimalDepot(n.pincode);if(m){e({type:"SET_DEPOT",payload:m});const x=await _.validateServiceAvailability(n.pincode);e({type:"SET_SERVICE_AVAILABILITY",payload:x}),await i(m.id)}else{const x=await _.getOnlineDepot();x?(e({type:"SET_DEPOT",payload:x}),await i(x.id)):e({type:"SET_ERROR",payload:{type:"DEPOT_NOT_FOUND",message:"No depot found for your location. Please try again later.",code:"DEPOT_NOT_FOUND"}})}}else if(r==="prompt")try{const n=await R.requestLocationWithExplanation();e({type:"SET_LOCATION",payload:n}),e({type:"SET_LOCATION_PERMISSION",payload:!0});const m=await _.getOptimalDepot(n.pincode);m&&(e({type:"SET_DEPOT",payload:m}),await i(m.id))}catch(n){e({type:"SET_ERROR",payload:n});const x=await _.getOnlineDepot();x&&(e({type:"SET_DEPOT",payload:x}),await i(x.id))}else{const n=await _.getOnlineDepot();n?(e({type:"SET_DEPOT",payload:n}),await i(n.id)):e({type:"SET_ERROR",payload:{type:"DEPOT_NOT_FOUND",message:"Location access denied and no online depot available.",code:"LOCATION_DENIED"}})}}catch(r){console.error("Error initializing location and depot:",r),e({type:"SET_ERROR",payload:{type:"API_ERROR",message:"Failed to initialize location services. Please try again.",details:r}})}finally{e({type:"SET_LOADING",payload:!1})}},[]),i=d.useCallback(async r=>{try{e({type:"SET_LOADING",payload:!0});const n=await B.getProducts(r);e({type:"SET_PRODUCTS",payload:n});const m=await B.getDepotVariants(r);e({type:"SET_DEPOT_VARIANTS",payload:m})}catch(n){console.error("Error loading products and variants:",n),e({type:"SET_ERROR",payload:{type:"API_ERROR",message:"Failed to load products. Please try again.",details:n}})}finally{e({type:"SET_LOADING",payload:!1})}},[]),l={setDepot:d.useCallback(async r=>{e({type:"SET_DEPOT",payload:r}),await i(r.id)},[i]),setLocation:d.useCallback(async r=>{e({type:"SET_LOCATION",payload:r});try{const n=await _.getOptimalDepot(r.pincode);n&&(e({type:"SET_DEPOT",payload:n}),await i(n.id))}catch(n){console.error("Error setting location:",n),e({type:"SET_ERROR",payload:{type:"API_ERROR",message:"Failed to set location. Please try again.",details:n}})}},[i]),refreshPricing:d.useCallback(async()=>{a.currentDepot&&await i(a.currentDepot.id)},[a.currentDepot,i]),setError:d.useCallback(r=>{e({type:"SET_ERROR",payload:r})},[]),setLoading:d.useCallback(r=>{e({type:"SET_LOADING",payload:r})},[]),setLocationPermission:d.useCallback(r=>{e({type:"SET_LOCATION_PERMISSION",payload:r})},[]),setServiceAvailability:d.useCallback(r=>{e({type:"SET_SERVICE_AVAILABILITY",payload:r})},[])},u={state:a,actions:l};return t.jsx(ne.Provider,{value:u,children:c})},$e=()=>{const c=d.useContext(ne);if(c===void 0)throw new Error("usePricing must be used within a PricingProvider");return c},Fe=(c=5)=>{const a="snf_recent_searches",[e,s]=d.useState(()=>{try{const r=localStorage.getItem(a);return r?JSON.parse(r):[]}catch{return[]}});return{recent:e,save:r=>{if(!r.trim())return;const n=[r.trim(),...e.filter(m=>m!==r.trim())].slice(0,c);s(n),localStorage.setItem(a,JSON.stringify(n))},remove:r=>{const n=e.filter(m=>m!==r);s(n),localStorage.setItem(a,JSON.stringify(n))},clear:()=>{s([]),localStorage.removeItem(a)}}},ee=()=>{const[c,a]=d.useState(!1),[e,s]=d.useState(""),[i,l]=d.useState(!1),[u,r]=d.useState(-1),[n,m]=d.useState("relevance"),[x,p]=d.useState("all"),h=d.useRef(null),N=d.useRef(null),{recent:P,save:O,remove:g,clear:v}=Fe(),L=Ne(),{state:D}=$e(),ie=d.useMemo(()=>{const o=new Set;return D.products.forEach(y=>{var b;const $=(b=y==null?void 0:y.category)==null?void 0:b.name;$&&o.add($)}),["all",...Array.from(o)]},[D.products]),[U,ce]=d.useState("");d.useEffect(()=>{const o=setTimeout(()=>ce(e),300);return()=>clearTimeout(o)},[e]);const I=d.useMemo(()=>{const o=U.trim().toLowerCase(),y=new Map;for(const f of D.depotVariants){const E=y.get(f.productId)||[];E.push(f),y.set(f.productId,E)}let b=D.products.map(f=>{var z;const A=(y.get(f.id)||[]).filter(w=>!w.isHidden&&!w.notInStock);let j=0,T,F=Number.POSITIVE_INFINITY;for(const w of A){const k=Number(w.buyOncePrice??w.mrp??0);isFinite(k)&&k>0&&k<F&&(F=k,j=k,T=typeof w.mrp=="number"&&isFinite(w.mrp)&&w.mrp>0?w.mrp:void 0)}(!isFinite(j)||j===0)&&(j=0,T=void 0);const ge=f.attachmentUrl?`http://localhost:3000${f.attachmentUrl}`:void 0,ye=(z=f==null?void 0:f.category)==null?void 0:z.name;return{id:f.id,name:f.name,description:f.description,imageUrl:ge,category:ye,price:j,mrp:T}}).filter(f=>{const E=!o||f.name.toLowerCase().includes(o)||(f.description||"").toLowerCase().includes(o)||(f.category||"").toLowerCase().includes(o),A=x==="all"||f.category===x;return E&&A});switch(n){case"price_asc":b=b.sort((f,E)=>(f.price||0)-(E.price||0));break;case"price_desc":b=b.sort((f,E)=>(E.price||0)-(f.price||0));break;case"relevance":default:{b=b.sort((f,E)=>{const A=f.name.toLowerCase(),j=E.name.toLowerCase(),T=A.startsWith(o)?2:A.includes(o)?1:0;return(j.startsWith(o)?2:j.includes(o)?1:0)-T});break}}return b.slice(0,10)},[U,x,n,D.products,D.depotVariants]);d.useEffect(()=>{if(!e){l(!1);return}l(!0);const o=setTimeout(()=>l(!1),320);return()=>clearTimeout(o)},[U]),d.useEffect(()=>{const o=y=>{N.current&&!N.current.contains(y.target)&&h.current&&!h.current.contains(y.target)&&(a(!1),r(-1))};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const le=o=>{console.log("analytics.impressions",{ids:o,query:e})},q=(o,y)=>{console.log("analytics.click",{id:o,position:y,query:e})};d.useEffect(()=>{c&&I.length&&le(I.map(o=>o.id))},[c,I]);const de=()=>a(!0),ue=o=>{s(o.target.value),a(!0)},me=o=>{if(c||a(!0),o.key==="ArrowDown")o.preventDefault(),r(y=>Math.min(y+1,I.length-1));else if(o.key==="ArrowUp")o.preventDefault(),r(y=>Math.max(y-1,0));else if(o.key==="Enter"){if(u>=0&&u<I.length){const y=I[u];O(e),q(y.id,u),L(`/snf/product/${y.id}`),a(!1),r(-1)}}else o.key==="Escape"&&(a(!1),r(-1))},pe=()=>s(""),he=o=>{const y=(o.price||0).toFixed(2);return o.mrp&&o.mrp>o.price?t.jsxs("span",{className:"text-sm",children:[t.jsxs("span",{className:"font-medium",children:["₹",y]}),t.jsxs("span",{className:"ml-2 text-xs line-through text-muted-foreground",children:["₹",o.mrp.toFixed(2)]})]}):t.jsxs("span",{className:"text-sm font-medium",children:["₹",y]})};return t.jsxs("div",{className:"relative w-full max-w-xl",children:[t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"flex items-center bg-gray-100 rounded-full px-4 py-2",children:[t.jsx(se,{className:"h-5 w-5 text-gray-500 mr-2","aria-hidden":"true"}),t.jsx("input",{ref:h,type:"search",role:"combobox","aria-autocomplete":"list","aria-expanded":c,"aria-controls":"search-suggestion-list","aria-activedescendant":u>=0?`search-option-${u}`:void 0,placeholder:"Search products...",className:"bg-transparent border-none focus:outline-none w-60",value:e,onChange:ue,onFocus:de,onKeyDown:me}),e&&t.jsx("button",{onClick:pe,className:"ml-2 text-gray-400 hover:text-gray-600","aria-label":"Clear search",children:t.jsx(Ee,{className:"h-4 w-4"})})]})}),c&&t.jsxs("div",{ref:N,id:"search-suggestion-list",role:"listbox",className:"absolute left-0 right-0 mt-2 bg-white rounded-lg shadow-lg z-[60] max-h-[460px] overflow-y-auto border",children:[t.jsxs("div",{className:"p-2 border-b flex items-center gap-2",children:[t.jsxs("select",{className:"text-xs border rounded px-2 py-1",value:n,onChange:o=>m(o.target.value),"aria-label":"Sort results",children:[t.jsx("option",{value:"relevance",children:"Relevance"}),t.jsx("option",{value:"price_asc",children:"Price: Low to High"}),t.jsx("option",{value:"price_desc",children:"Price: High to Low"})]}),t.jsx("select",{className:"text-xs border rounded px-2 py-1 ml-auto",value:x,onChange:o=>p(o.target.value),"aria-label":"Filter by category",children:ie.map(o=>t.jsx("option",{value:o,children:o},o))})]}),t.jsxs("div",{className:"p-2",children:[!e&&P.length>0&&t.jsxs("div",{className:"mb-2",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[t.jsx("h3",{className:"text-xs font-semibold text-gray-500",children:"RECENT SEARCHES"}),t.jsx("button",{className:"text-xs text-blue-600",onClick:v,children:"Clear all"})]}),P.map(o=>t.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 hover:bg-gray-50 rounded",children:[t.jsx("button",{className:"text-sm text-left truncate flex-1",onClick:()=>s(o),children:o}),t.jsx("button",{className:"text-xs text-muted-foreground ml-2",onClick:()=>g(o),children:"Remove"})]},o))]}),i&&t.jsx("div",{className:"flex justify-center items-center py-6",children:t.jsx("div",{className:"text-sm text-muted-foreground",children:"Searching…"})}),!i&&e&&I.length===0&&t.jsxs("div",{className:"px-3 py-6 text-center text-sm text-muted-foreground",children:["No products found for “",e,"”. Try a different term or adjust filters."]}),!i&&I.map((o,y)=>t.jsxs(G,{to:`/snf/product/${o.id}`,role:"option",id:`search-option-${y}`,"aria-selected":u===y,onClick:()=>{O(e),q(o.id,y),a(!1),r(-1)},className:`flex gap-3 px-3 py-2 rounded-md hover:bg-gray-50 focus:bg-gray-50 outline-none ${u===y?"ring-2 ring-primary":""}`,children:[t.jsx("div",{className:"w-20 h-16 rounded border overflow-hidden bg-muted/20 grid place-items-center",children:o.imageUrl?t.jsx("img",{src:o.imageUrl,alt:o.name,width:80,height:60,className:"w-full h-full object-cover",loading:"lazy"}):t.jsx("span",{className:"text-[10px] text-muted-foreground",children:"No image"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-sm font-medium truncate",children:o.name}),o.category&&t.jsx("div",{className:"text-xs text-muted-foreground truncate",children:o.category}),t.jsx("div",{className:"mt-1 flex items-center gap-2",children:he(o)})]})]},o.id))]})]})]})};class C{static getCurrentLocation(){try{const a=localStorage.getItem(this.STORAGE_KEY);return a?JSON.parse(a):null}catch(a){return console.warn("Failed to parse delivery location from storage:",a),null}}static setCurrentLocation(a){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(a))}catch(e){console.warn("Failed to store delivery location:",e)}}static clearCurrentLocation(){localStorage.removeItem(this.STORAGE_KEY)}static async getDepotForPincode(a){try{const e=await be(a);if(e.length===0)return null;const s=e.find(l=>l.depot);if(!s||!s.depot)return null;const i={pincode:a,depotId:s.depot.id.toString(),depotName:s.depot.name,areaId:s.id,areaName:s.name};return this.setCurrentLocation(i),i}catch(e){return console.error("Failed to get depot for pincode:",e),null}}static async updateLocationByPincode(a){return this.clearCurrentLocation(),!a||!/^\d{6}$/.test(a)?null:await this.getDepotForPincode(a)}static getCurrentDepotId(){const a=this.getCurrentLocation();return(a==null?void 0:a.depotId)||null}static hasDeliveryLocation(){const a=this.getCurrentLocation();return!!(a&&a.pincode&&a.depotId)}static async migrateFromOldPincodeStorage(){if(this.hasDeliveryLocation())return;const a=localStorage.getItem("snf.pincode");a&&/^\d{6}$/.test(a)&&(await this.updateLocationByPincode(a),localStorage.removeItem("snf.pincode"))}}S(C,"STORAGE_KEY","snf.deliveryLocation");const Ge={items:[]},te="snf.cart";function qe(c,a){switch(a.type){case"SET":return a.payload;case"ADD_ITEM":{const e=c.items.findIndex(s=>s.variantId===a.payload.variantId);if(e>=0){const s=[...c.items];return s[e]={...s[e],quantity:s[e].quantity+a.payload.quantity},{items:s}}return{items:[...c.items,a.payload]}}case"REMOVE_ITEM":return{items:c.items.filter(e=>e.variantId!==a.payload.variantId)};case"INCREMENT":return{items:c.items.map(e=>e.variantId===a.payload.variantId?{...e,quantity:Math.min(99,e.quantity+1)}:e)};case"DECREMENT":return{items:c.items.map(e=>e.variantId===a.payload.variantId?{...e,quantity:Math.max(1,e.quantity-1)}:e)};case"CLEAR":return{items:[]};default:return c}}const oe=d.createContext(void 0),We=({children:c})=>{const[a,e]=d.useReducer(qe,Ge,p=>{try{const h=localStorage.getItem(te);if(h){const N=JSON.parse(h);if(N&&Array.isArray(N.items))return N}}catch{}return p});d.useEffect(()=>{try{localStorage.setItem(te,JSON.stringify(a))}catch{}},[a]);const s=d.useMemo(()=>a.items.reduce((p,h)=>p+h.price*h.quantity,0),[a.items]),i=d.useMemo(()=>a.items.reduce((p,h)=>p+h.quantity,0),[a.items]),x={state:a,addItem:(p,h,N=1)=>{var L;const P=(h==null?void 0:h.buyOncePrice)||(h==null?void 0:h.mrp)||0,O=(L=p==null?void 0:p.product)==null?void 0:L.attachmentUrl,g=O?`http://localhost:3000${O}`:void 0,v={productId:p.product.id,variantId:h.id,name:p.product.name,variantName:h.name||"",price:typeof P=="number"?P:0,quantity:Math.max(1,Math.min(99,N||1)),imageUrl:g};e({type:"ADD_ITEM",payload:v})},removeItem:p=>e({type:"REMOVE_ITEM",payload:{variantId:p}}),increment:p=>e({type:"INCREMENT",payload:{variantId:p}}),decrement:p=>e({type:"DECREMENT",payload:{variantId:p}}),clear:()=>e({type:"CLEAR"}),subtotal:s,totalQuantity:i};return t.jsx(oe.Provider,{value:x,children:c})};function ze(){const c=d.useContext(oe);if(!c)throw new Error("useCart must be used within CartProvider");return c}const ae=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}),Be=()=>{const{state:c,subtotal:a,totalQuantity:e,increment:s,decrement:i,removeItem:l}=ze(),[u,r]=d.useState(!1);return d.useEffect(()=>{r(!0);const n=setTimeout(()=>r(!1),300);return()=>clearTimeout(n)},[e]),t.jsxs(we,{children:[t.jsx(Ie,{asChild:!0,children:t.jsxs("button",{id:"snf-cart-button",className:"relative inline-flex items-center justify-center rounded-md h-9 w-9 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-ring","aria-label":"Cart",children:[t.jsx(je,{className:"size-5","aria-hidden":!0}),t.jsx("span",{className:`absolute -top-1 -right-1 min-w-5 h-5 px-1 rounded-full bg-primary text-[10px] text-primary-foreground grid place-items-center transition-transform duration-300 ${u?"scale-110":""}`,"aria-live":"polite","aria-atomic":"true",children:e})]})}),t.jsxs(Se,{align:"end",sideOffset:8,className:"z-[60] w-80 sm:w-96 p-0",children:[t.jsx("div",{className:"p-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-sm font-semibold",children:"Your Cart"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[e," items"]})]})}),t.jsx(K,{}),t.jsx("div",{className:"max-h-80 overflow-y-auto",children:c.items.length===0?t.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Your cart is empty."}):t.jsx("ul",{className:"divide-y",children:c.items.map(n=>t.jsxs("li",{className:"p-3 flex gap-3",children:[t.jsx("div",{className:"size-14 shrink-0 rounded-md overflow-hidden bg-muted/30 grid place-items-center",children:n.imageUrl?t.jsx("img",{src:n.imageUrl,alt:n.name,className:"h-full w-full object-cover",loading:"lazy"}):t.jsx("span",{className:"text-xs text-muted-foreground",children:"No image"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:n.name}),t.jsx("p",{className:"text-xs text-muted-foreground truncate",children:n.variantName})]}),t.jsx("button",{className:"p-1 rounded hover:bg-accent",onClick:()=>l(n.variantId),"aria-label":`Remove ${n.name}`,children:t.jsx(Pe,{className:"size-4"})})]}),t.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[t.jsxs("div",{className:"inline-flex items-center gap-2 border rounded-md px-2 py-1",children:[t.jsx("button",{className:"p-1 rounded hover:bg-accent",onClick:()=>i(n.variantId),"aria-label":"Decrease quantity",children:t.jsx(Oe,{className:"size-4"})}),t.jsx("span",{className:"text-sm w-5 text-center",children:n.quantity}),t.jsx("button",{className:"p-1 rounded hover:bg-accent",onClick:()=>s(n.variantId),"aria-label":"Increase quantity",children:t.jsx(_e,{className:"size-4"})})]}),t.jsx("div",{className:"text-sm font-medium",children:ae.format(n.price*n.quantity)})]})]})]},n.variantId))})}),t.jsx(K,{}),t.jsxs("div",{className:"p-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),t.jsx("span",{className:"font-semibold",children:ae.format(a)})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(M,{variant:"outline",size:"sm",asChild:!0,children:t.jsx(G,{to:"/snf",children:"Continue shopping"})}),t.jsx(M,{size:"sm",disabled:c.items.length===0,asChild:!0,children:t.jsx(G,{to:"/snf/checkout",children:"Checkout"})})]})]})]})]})},He=c=>{const[a,e]=d.useState(!1),[s,i]=d.useState(!1),[l,u]=d.useState(()=>C.getCurrentLocation()),[r,n]=d.useState(()=>(l==null?void 0:l.pincode)||""),[m,x]=d.useState(null),[p,h]=d.useState(null),N=/^\d{6}$/.test(r);d.useEffect(()=>{const g=()=>e(window.scrollY>8);return window.addEventListener("scroll",g,{passive:!0}),()=>window.removeEventListener("scroll",g)},[]),d.useEffect(()=>{(async()=>{await C.migrateFromOldPincodeStorage();const v=C.getCurrentLocation();v&&(u(v),n(v.pincode))})()},[]);const P=async()=>{h(null),x("pin");try{const g=await C.updateLocationByPincode(r);g?(u(g),n(g.pincode),i(!1),console.log(`Location updated: ${g.pincode} -> Depot: ${g.depotName} (${g.depotId})`)):h("We don't deliver to this pincode yet. Check back soon!")}catch(g){h((g==null?void 0:g.message)||"Failed to resolve pincode")}finally{x(null)}},O=async()=>{h(null),x("geo");try{const g=await R.requestLocationWithExplanation(),v=await C.updateLocationByPincode(g.pincode);v?(u(v),n(v.pincode),i(!1),console.log(`Location detected: ${v.pincode} -> Depot: ${v.depotName} (${v.depotId})`)):(n(g.pincode),h("We don't deliver to this location yet. Check back soon!"))}catch(g){h((g==null?void 0:g.message)||"Unable to get location")}finally{x(null)}};return t.jsx("header",{className:`top-0 inset-x-0 z-40 bg-background/95 supports-[backdrop-filter]:bg-background/60 backdrop-blur border-b transition-all pt-[env(safe-area-inset-top)] ${a?"sticky shadow-sm":"relative"}`,"aria-label":"SNF store global header",children:t.jsxs("div",{className:"container mx-auto px-3 md:px-6 lg:px-8",children:[t.jsxs("div",{className:"h-14 md:h-16 flex items-center justify-between gap-2 md:gap-3 min-w-0",children:[t.jsxs("a",{href:"/snf",className:"flex items-center gap-2 min-w-0","aria-label":"SNF Home",children:[t.jsx("div",{className:"size-8 rounded-md bg-primary text-primary-foreground grid place-items-center font-bold shrink-0",children:"S"}),t.jsx("span",{className:"hidden sm:inline text-base md:text-lg font-semibold tracking-tight truncate",children:"SNF Market"})]}),t.jsx("div",{className:"flex-1 max-w-xl hidden md:flex items-center min-w-0",children:t.jsx(ee,{})}),t.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2 shrink-0",children:[t.jsxs(V,{open:s,onOpenChange:i,children:[t.jsx(Y,{asChild:!0,children:t.jsxs(M,{variant:"outline",size:"sm","aria-label":"Select delivery location",className:"whitespace-nowrap",children:[t.jsx(W,{className:"size-4"}),l&&l.depotName?t.jsxs("span",{className:"hidden sm:inline",children:[l.pincode," • ",l.depotName]}):r?t.jsxs("span",{className:"hidden sm:inline",children:["Pincode: ",r]}):t.jsx("span",{className:"hidden sm:inline",children:"Set location"})]})}),t.jsxs(H,{align:"end",sideOffset:8,className:"w-72 z-[60]",children:[t.jsxs(J,{className:"flex items-center gap-2",children:[t.jsx(W,{className:"size-4"}),"Choose delivery location"]}),t.jsxs("div",{className:"px-2 py-1.5",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(De,{inputMode:"numeric",pattern:"\\d{6}",maxLength:6,placeholder:"Enter 6-digit pincode",value:r,onChange:g=>{const v=g.target.value.replace(/\D/g,"").slice(0,6);n(v),h(null)},"aria-invalid":r.length>0&&!N}),t.jsx(M,{size:"sm",disabled:!N||m==="pin",onClick:P,"aria-label":"Apply pincode",children:m==="pin"?t.jsx(Q,{className:"size-4 animate-spin"}):t.jsx(Ae,{className:"size-4"})})]}),p&&t.jsx("p",{className:"text-xs text-destructive mt-1",children:p}),!p&&r&&!N&&t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Pincode must be 6 digits"})]}),t.jsx(X,{}),t.jsxs(Z,{onClick:O,className:"cursor-pointer",disabled:m==="geo",children:[m==="geo"?t.jsx(Q,{className:"size-4 animate-spin"}):t.jsx(Le,{className:"size-4"}),"Use my current location"]})]})]}),t.jsx("div",{className:"hidden sm:inline-flex",children:t.jsx(Ce,{isLoggedIn:!0})}),t.jsx("a",{href:"/snf",className:"md:hidden inline-flex items-center justify-center rounded-md h-9 w-9 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-ring","aria-label":"Search",children:t.jsx(se,{className:"size-5","aria-hidden":"true"})}),t.jsxs(V,{children:[t.jsx(Y,{asChild:!0,children:t.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-md h-9 w-9 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-ring","aria-label":"Account",children:t.jsx(Te,{className:"size-5","aria-hidden":!0})})}),t.jsxs(H,{align:"end",sideOffset:8,className:"w-44",children:[t.jsx(J,{children:"Account"}),t.jsx(X,{}),t.jsx(Z,{asChild:!0,children:t.jsx("a",{href:"/snf/address",className:"w-full",children:"Address"})})]})]}),t.jsx(Be,{})]})]}),t.jsx("div",{className:"md:hidden pb-2",children:t.jsx(ee,{})})]})})},Je=()=>t.jsxs("footer",{className:"bg-slate-50 dark:bg-gray-900 text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-x-8 gap-y-10",children:[t.jsxs("div",{className:"md:col-span-12 lg:col-span-4",children:[t.jsxs("div",{className:"mb-6 flex items-center",children:[t.jsx("span",{className:"inline-grid place-items-center h-10 w-10 rounded bg-primary text-primary-foreground mr-3 font-bold",children:"S"}),t.jsx("span",{className:"text-xl font-bold",children:"SNF Market"})]}),t.jsx("p",{className:"text-sm mb-6 leading-relaxed",children:"Fresh groceries delivered fast. Pure, natural, and carefully curated selection."}),t.jsx("h3",{className:"text-[0.9rem] font-semibold mb-3 text-gray-600 dark:text-gray-400",children:"Payment Accepted"}),t.jsx("div",{className:"flex flex-wrap gap-2 items-center",children:["Mastercard","Discover","UPI","Visa","Stripe"].map(c=>t.jsx("span",{className:"text-xs px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded-md shadow-sm",children:c},c))})]}),t.jsx("div",{className:"hidden lg:block lg:col-span-1"}),t.jsxs("div",{className:"md:col-span-4 lg:col-span-2",children:[t.jsx("h3",{className:"text-md font-semibold mb-4 border-b-2 border-primary pb-1 inline-block",children:"Policies"}),t.jsxs("ul",{className:"space-y-2.5 text-sm",children:[t.jsx("li",{children:t.jsx("a",{href:"/privacy-policy",className:"hover:text-primary transition-colors",children:"Privacy Policy"})}),t.jsx("li",{children:t.jsx("a",{href:"/refund-policy",className:"hover:text-primary transition-colors",children:"Refund Policy"})}),t.jsx("li",{children:t.jsx("a",{href:"/shipping-policy",className:"hover:text-primary transition-colors",children:"Shipping Policy"})}),t.jsx("li",{children:t.jsx("a",{href:"/terms-and-conditions",className:"hover:text-primary transition-colors",children:"Terms & Conditions"})})]})]}),t.jsxs("div",{className:"md:col-span-4 lg:col-span-2",children:[t.jsx("h3",{className:"text-md font-semibold mb-4 border-b-2 border-primary pb-1 inline-block",children:"Useful Links"}),t.jsxs("ul",{className:"space-y-2.5 text-sm",children:[t.jsx("li",{children:t.jsx("a",{href:"/snf",className:"hover:text-primary transition-colors",children:"Home"})}),t.jsx("li",{children:t.jsx("a",{href:"/snf#products",className:"hover:text-primary transition-colors",children:"Products"})}),t.jsx("li",{children:t.jsx("a",{href:"/about",className:"hover:text-primary transition-colors",children:"About"})}),t.jsx("li",{children:t.jsx("a",{href:"/contact",className:"hover:text-primary transition-colors",children:"Contact"})})]})]}),t.jsxs("div",{className:"md:col-span-4 lg:col-span-3",children:[t.jsx("h3",{className:"text-md font-semibold mb-4 border-b-2 border-primary pb-1 inline-block",children:"Contact"}),t.jsxs("address",{className:"text-sm not-italic space-y-2 leading-relaxed",children:[t.jsx("p",{children:"SNF Market, Fresh Street, Farm District, 421201"}),t.jsx("p",{children:t.jsx("a",{href:"mailto:hello@snf.example",className:"hover:text-primary transition-colors break-all",children:"hello@snf.example"})}),t.jsx("p",{children:t.jsx("a",{href:"tel:+910000000000",className:"hover:text-primary transition-colors",children:"+91 0000000000"})})]})]})]})}),t.jsx("div",{className:"bg-gray-200 dark:bg-gray-800 py-4 border-t border-gray-300 dark:border-gray-700",children:t.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-600 dark:text-gray-400",children:[t.jsxs("p",{className:"mb-2 md:mb-0 text-center md:text-left",children:["© ",new Date().getFullYear()," SNF Market. All Rights Reserved."]}),t.jsx("p",{className:"text-center md:text-right",children:"Built with love and veggies."})]})})]});export{We as C,C as D,Je as F,He as H,Ye as P,ze as a,$e as u};
