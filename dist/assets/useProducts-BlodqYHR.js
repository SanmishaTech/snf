import{r as t}from"./index-De4PDMAM.js";import{p as h}from"./Footer-CT_xEc2i.js";const L=e=>{const[s,S]=t.useState([]),[D,E]=t.useState([]),[m,k]=t.useState([]),[p,d]=t.useState(null),[l,o]=t.useState(!1),c=t.useCallback((i,P)=>i.map(r=>{const f=P.filter(u=>u.productId===r.id),n=f.reduce((u,v)=>{if(!u)return v;const C=u.buyOncePrice??u.mrp;return(v.buyOncePrice??v.mrp)<C?v:u},null),w=f.some(u=>!u.notInStock&&u.closingQty>0);let R=0;const g=(n==null?void 0:n.buyOncePrice)??(n==null?void 0:n.mrp),O=(n==null?void 0:n.mrp)??0;return g&&g<O&&(R=(O-g)/O),{product:r,variants:f,buyOncePrice:g||0,mrp:O,discount:R>0?R:void 0,inStock:w,deliveryTime:w?"Same day delivery":"Out of stock"}}).filter(r=>r.variants.length>0),[]),a=t.useCallback(async()=>{if(e){o(!0),d(null);try{const i=await h.getProducts(e),P=await h.getDepotVariants(e);E(i),k(P);const r=c(i,P);S(r)}catch(i){d({type:"API_ERROR",message:"Failed to fetch products",code:"PRODUCTS_FETCH_FAILED",recoverable:!0,details:i})}finally{o(!1)}}},[e,c]),y=t.useCallback(async()=>{e&&await a()},[e,a]);return t.useEffect(()=>{e&&a()},[e,a]),{products:s,rawProducts:D,variants:m,error:p,isLoading:l,refresh:y}},Q=(e,s)=>{const[S,D]=t.useState(null),[E,m]=t.useState(null),[k,p]=t.useState(!1),d=t.useCallback(async()=>{if(!(!e||!s)){p(!0),m(null);try{const[l,o]=await Promise.all([h.getProductById(e),h.getProductVariants(e,s)]);if(!l)throw{type:"API_ERROR",message:"Product not found",code:"PRODUCT_NOT_FOUND",recoverable:!1};console.log("Product data fetched:",l),console.log("Variants data fetched:",o),o.length===0&&(console.warn(`No depot variants found for product ${e} in depot ${s}`),o=[{id:0,depotId:s,productId:e,name:"Default",hsnCode:"",minimumQty:1,closingQty:0,notInStock:!0,isHidden:!1,buyOncePrice:void 0,price15Day:void 0,price1Month:void 0,price3Day:void 0,price7Day:void 0,mrp:0,purchasePrice:void 0,createdAt:new Date,updatedAt:new Date,depot:{id:s,name:"Depot",address:"",isOnline:!0},product:l}]);const c=o.reduce((r,f)=>{if(!r)return f;const n=r.buyOncePrice??r.mrp;return(f.buyOncePrice??f.mrp)<n?f:r},null),a=(c==null?void 0:c.buyOncePrice)??(c==null?void 0:c.mrp),y=(c==null?void 0:c.mrp)??0;let i=0;a&&a<y&&(i=(y-a)/y);const P={product:l,variants:o,buyOncePrice:a||0,mrp:y,discount:i>0?i:void 0,inStock:o.some(r=>!r.notInStock&&r.closingQty>0),deliveryTime:o.some(r=>!r.notInStock&&r.closingQty>0)?"Same day delivery":"Out of stock"};D(P)}catch(l){m(l)}finally{p(!1)}}},[e,s]);return t.useEffect(()=>{e&&s&&d()},[e,s,d]),{product:S,error:E,isLoading:k,refresh:d}};export{L as a,Q as u};
